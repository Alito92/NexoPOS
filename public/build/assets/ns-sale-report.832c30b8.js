import{y as a,_ as r,m as p,p as i}from"./bootstrap.4fc50695.js";import{e as u,f as m}from"./components.e6ff6fc8.js";import{n as l}from"./ns-select-popup.c6b15ec9.js";import{_ as c}from"./plugin-vue_export-helper.21dcd24c.js";import"./ns-notice.3d1887a3.js";import"./ns-pos-confirm-popup.04ed5413.js";import"./ns-numpad-plus.89338cd1.js";import"./ns-paginate.01fa3ad3.js";import"./ns-prompt-popup.38fbac9c.js";import"./ns-alert-popup.e97ff427.js";import"./ns-pos-loading-popup.c4bd0a89.js";const h={name:"ns-sale-report",data(){return{startDate:a(),endDate:a(),result:[],users:[],summary:{},selectedUser:"",reportType:{label:r("Report Type"),name:"reportType",type:"select",value:"categories_report",options:[{label:r("Categories Detailed"),name:"categories_report"},{label:r("Categories Summary"),name:"categories_summary"},{label:r("Products"),name:"products_report"}],description:r("Allow you to choose the report type.")},filterUser:{label:r("Filter User"),name:"filterUser",type:"select",value:"",options:[],description:r("Allow you to choose the report type.")},field:{type:"datetimepicker",value:"2021-02-07",name:"date"}}},components:{nsDatepicker:u,nsDateTimePicker:m},computed:{},methods:{printSaleReport(){this.$htmlToPaper("sale-report")},setStartDate(e){this.startDate=e.format()},async openSettings(){try{const e=await new Promise((s,t)=>{Popup.show(l,{...this.reportType,resolve:s,reject:t})});this.reportType.value=e[0].name,this.result=[],this.loadReport()}catch{}},async openUserFiltering(){try{const e=await new Promise((s,t)=>{p.get("/api/nexopos/v4/users").subscribe({next:o=>{this.users=o,this.filterUser.options=[{label:r("All Users"),value:""},...this.users.map(n=>({label:n.username,value:n.id}))],Popup.show(l,{...this.filterUser,resolve:s,reject:t})},error:o=>{i.error(r("No user was found for proceeding the filtering.")),t(o)}})});this.selectedUser=e[0].label,this.filterUser.value=e[0].value,this.result=[],this.loadReport()}catch{}},getType(e){const s=this.reportType.options.filter(t=>t.name===e);return s.length>0?s[0].label:r("Unknown")},loadReport(){if(this.startDate===null||this.endDate===null)return i.error(r("Unable to proceed. Select a correct time range.")).subscribe();const e=a(this.startDate);if(a(this.endDate).isBefore(e))return i.error(r("Unable to proceed. The current time range is not valid.")).subscribe();p.post("/api/nexopos/v4/reports/sale-report",{startDate:this.startDate,endDate:this.endDate,type:this.reportType.value,user_id:this.filterUser.value}).subscribe({next:t=>{this.result=t.result,this.summary=t.summary},error:t=>{i.error(t.message).subscribe()}})},computeTotal(e,s){return e.length>0?e.map(t=>parseFloat(t[s])).reduce((t,o)=>t+o):0},setEndDate(e){this.endDate=e.format()}}};function d(e,s,t,o,n,f){return null}var S=c(h,[["render",d]]);export{S as default};
