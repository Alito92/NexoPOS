import{s as S,A as O,_ as h,j as g,o as l,a as c,f as t,t as n,q as f,e as u,F as v,r as C,i as j,B as P,p as y,m as w,n as R,h as V}from"./bootstrap.f2724e83.js";import B from"./ns-pos-confirm-popup.e8c513d2.js";import{_ as m}from"./plugin-vue_export-helper.21dcd24c.js";import{n as I}from"./currency.cdd08e48.js";const H={components:{},data(){return{amount:0,title:null,identifier:null,settingsSubscription:null,settings:null,action:null,register:null,loaded:!1,register_id:null,validation:new S,fields:[]}},mounted(){this.title=this.$popupParams.title,this.identifier=this.$popupParams.identifier,this.register=this.$popupParams.register,this.action=this.$popupParams.action,this.register_id=this.$popupParams.register_id,this.settingsSubscription=POS.settings.subscribe(e=>{this.settings=e}),this.loadFields()},destroyed(){this.settingsSubscription.unsubscribe()},methods:{popupCloser:O,__:h,definedValue(e){this.amount=e},close(){this.$popup.close()},loadFields(){this.loaded=!1,nsHttpClient.get(`/api/nexopos/v4/fields/${this.identifier}`).subscribe(e=>{this.loaded=!0,this.fields=e},e=>(this.loaded=!0,nsSnackBar.error(e.message,"OKAY",{duration:!1}).subscribe()))},submit(e){Popup.show(B,{title:"Confirm Your Action",message:this.$popupParams.confirmMessage||"Would you like to confirm your action.",onAction:s=>{s&&this.triggerSubmit()}})},triggerSubmit(){const e=this.validation.extractFields(this.fields);e.amount=this.amount===""?0:this.amount,nsHttpClient.post(`/api/nexopos/v4/cash-registers/${this.action}/${this.register_id||this.settings.register.id}`,e).subscribe({next:s=>{this.$popupParams.resolve(s),this.$popup.close(),nsSnackBar.success(s.message).subscribe()},error:s=>{nsSnackBar.error(s.message).subscribe()}})}}},F={key:0,class:"shadow-lg w-95vw md:w-2/5-screen ns-box"},N={class:"border-b ns-box-header p-2 text-primary flex justify-between items-center"},L={class:"font-semibold"},A={class:"p-2"},z={key:0,class:"mb-2 p-3 elevation-surface font-bold border text-right flex justify-between"},D={class:"mb-2 p-3 elevation-surface success border font-bold text-right flex justify-between"},Q={class:"mb-2"},T={key:1,class:"h-full w-full flex items-center justify-center"};function U(e,s,a,d,i,r){const p=g("ns-close-button"),o=g("ns-numpad"),_=g("ns-field"),k=g("ns-spinner");return l(),c("div",null,[i.loaded?(l(),c("div",F,[t("div",N,[t("h3",L,n(i.title),1),t("div",null,[f(p,{onClick:s[0]||(s[0]=b=>r.close())})])]),t("div",A,[i.register!==null?(l(),c("div",z,[t("span",null,n(r.__("Balance")),1),t("span",null,n(e.nsCurrency(i.register.balance)),1)])):u("",!0),t("div",D,[t("span",null,n(r.__("Input")),1),t("span",null,n(e.nsCurrency(i.amount)),1)]),t("div",Q,[f(o,{floating:!0,onNext:s[1]||(s[1]=b=>r.submit(b)),value:i.amount,onChanged:s[2]||(s[2]=b=>r.definedValue(b))},null,8,["value"])]),(l(!0),c(v,null,C(i.fields,(b,$)=>(l(),j(_,{field:b,key:$},null,8,["field"]))),128))])])):u("",!0),i.loaded?u("",!0):(l(),c("div",T,[f(k)]))])}var x=m(H,[["render",U]]);const q={components:{nsNumpad},data(){return{registers:[],priorVerification:!1,hasLoadedRegisters:!1,validation:new S,amount:0,settings:null,settingsSubscription:null}},mounted(){this.checkUsedRegister(),this.settingsSubscription=POS.settings.subscribe(e=>{this.settings=e})},beforeDestroy(){this.settingsSubscription.unsubscribe()},computed:{},methods:{__:h,popupResolver:P,async selectRegister(e){if(e.status!=="closed")return y.error(h("Unable to open this register. Only closed register can be opened.")).subscribe();try{const s=await new Promise((a,d)=>{const i=h("Open Register : %s").replace("%s",e.name),r="open",p=e.id,o="ns.cash-registers-opening";Popup.show(x,{resolve:a,reject:d,title:i,identifier:o,register:e,action:r,register_id:p})});this.popupResolver(s)}catch(s){console.log(s)}},checkUsedRegister(){this.priorVerification=!1,w.get("/api/nexopos/v4/cash-registers/used").subscribe({next:e=>{this.$popupParams.resolve(e),this.$popup.close()},error:e=>{this.priorVerification=!0,y.error(e.message).subscribe(),this.loadRegisters()}})},loadRegisters(){this.hasLoadedRegisters=!1,w.get("/api/nexopos/v4/cash-registers").subscribe(e=>{this.registers=e,this.hasLoadedRegisters=!0})},getClass(e){switch(e.status){case"in-use":return"elevation-surface warning cursor-not-allowed";case"disabled":return"elevation-surface cursor-not-allowed";case"available":return"elevation-surface success"}return"elevation-surface hoverable cursor-pointer"}}},E={key:0,class:"h-full w-full py-10 flex justify-center items-center"},Y={class:"title p-2 border-b ns-box-header flex justify-between items-center"},K={class:"font-semibold"},M={key:0},W=["href"],G={key:0,class:"py-10 flex-auto overflow-y-auto flex items-center justify-center"},J={key:1,class:"flex-auto overflow-y-auto"},X={class:"grid grid-cols-3"},Z=["onClick"],ee=t("i",{class:"las la-cash-register text-6xl"},null,-1),se={class:"text-semibold text-center"},te={class:"text-sm"},ie={key:0,class:"p-2 alert text-white"},re=["href"];function ne(e,s,a,d,i,r){const p=g("ns-spinner");return l(),c("div",null,[i.priorVerification===!1?(l(),c("div",E,[f(p,{size:"24",border:"8"})])):u("",!0),i.priorVerification?(l(),c("div",{key:1,id:"ns-pos-cash-registers-popup",class:R(["w-95vw md:w-3/5-screen lg:w-3/5-screen xl:w-2/5-screen flex flex-col overflow-hidden",i.priorVerification?"shadow-lg ns-box":""])},[t("template",null,[t("div",Y,[t("h3",K,n(r.__("Open The Register")),1),i.settings?(l(),c("div",M,[t("a",{href:i.settings.urls.orders_url,class:"rounded-full border ns-close-button px-3 text-sm py-1"},n(r.__("Exit To Orders")),9,W)])):u("",!0)]),i.hasLoadedRegisters?u("",!0):(l(),c("div",G,[f(p,{size:"16",border:"4"})])),i.hasLoadedRegisters?(l(),c("div",J,[t("div",X,[(l(!0),c(v,null,C(i.registers,(o,_)=>(l(),c("div",{onClick:k=>r.selectRegister(o),class:R([r.getClass(o),"border flex items-center justify-center flex-col p-3"]),key:_},[ee,t("h3",se,n(o.name),1),t("span",te,"("+n(o.status_label)+")",1)],10,Z))),128))]),i.registers.length===0?(l(),c("div",ie,[V(n(r.__("Looks like there is no registers. At least one register is required to proceed."))+" \u2014 ",1),t("a",{class:"font-bold hover:underline",href:i.settings.urls.registers_url},n(r.__("Create Cash Register")),9,re)])):u("",!0)])):u("",!0)])],2)):u("",!0)])}var oe=m(q,[["render",ne]]);const le={data(){return{totalIn:0,totalOut:0,settings:null,settingsSubscription:null,histories:[]}},mounted(){this.settingsSubscription=POS.settings.subscribe(e=>{this.settings=e}),this.getHistory()},destroyed(){this.settingsSubscription.unsubscribe()},methods:{__:h,nsCurrency:I,popupResolver:P,closePopup(){this.popupResolver({status:"success"})},getHistory(){w.get(`/api/nexopos/v4/cash-registers/session-history/${this.settings.register.id}`).subscribe(e=>{this.histories=e,this.totalIn=this.histories.filter(s=>["register-opening","register-sale","register-cash-in"].includes(s.action)).map(s=>parseFloat(s.value)).reduce((s,a)=>s+a,0),this.totalOut=this.histories.filter(s=>["register-closing","register-refund","register-cash-out"].includes(s.action)).map(s=>parseFloat(s.value)).reduce((s,a)=>s+a,0),console.log(this.totalOut)})}}},ce={class:"ns-box shadow-lg w-95vw md:w-4/6-screen lg:w-half overflow-hidden"},ae={id:"header",class:"p-2 flex justify-between items-center ns-box-header"},ue={class:"font-bold"},de={class:"flex w-full ns-box-body"},he={class:"flex flex-auto"},pe={class:"w-full md:w-1/2 text-right bg-success-primary text-white font-bold text-3xl p-3"},_e={class:"w-full md:w-1/2 text-right bg-error-primary text-white font-bold text-3xl p-3"},ge={class:"flex flex-col overflow-y-auto h-120"},fe={class:"p-2 flex-auto"},be={class:"flex-auto text-right p-2"},me={class:"p-2 flex-auto"},xe={class:"flex-auto text-right p-2"},ve={class:"p-2 flex-auto"},ye={class:"flex-auto text-right p-2"},we={class:"p-2 flex-auto"},Ce={class:"flex-auto text-right p-2"};function Pe(e,s,a,d,i,r){const p=g("ns-close-button");return l(),c("div",ce,[t("div",ae,[t("h3",ue,n(r.__("Register History")),1),t("div",null,[f(p,{onClick:r.closePopup},null,8,["onClick"])])]),t("div",de,[t("div",he,[t("div",pe,n(r.nsCurrency(i.totalIn)),1),t("div",_e,n(r.nsCurrency(i.totalOut)),1)])]),t("div",ge,[(l(!0),c(v,null,C(i.histories,o=>(l(),c(v,null,[["register-sale","register-cash-in"].includes(o.action)?(l(),c("div",{key:o.id,class:"flex border-b elevation-surface success"},[t("div",fe,n(o.label),1),t("div",be,n(r.nsCurrency(o.value)),1)])):u("",!0),["register-opening"].includes(o.action)?(l(),c("div",{key:o.id,class:"flex border-b elevation-surface"},[t("div",me,n(o.label),1),t("div",xe,n(r.nsCurrency(o.value)),1)])):u("",!0),["register-close"].includes(o.action)?(l(),c("div",{key:o.id,class:"flex border-b elevation-surface info"},[t("div",ve,n(o.label),1),t("div",ye,n(r.nsCurrency(o.value)),1)])):u("",!0),["register-refund","register-cash-out"].includes(o.action)?(l(),c("div",{key:o.id,class:"flex border-b elevation-surface error"},[t("div",we,n(o.label),1),t("div",Ce,n(r.nsCurrency(o.value)),1)])):u("",!0)],64))),256))])])}var ke=m(le,[["render",Pe]]);const Re={mounted(){this.settingsSubscriber=POS.settings.subscribe(e=>{this.settings=e}),this.popupCloser(),this.loadRegisterSummary()},beforeDestroy(){this.settingsSubscriber.unsubscribe()},data(){return{settings:null,settingsSubscriber:null,register:{}}},methods:{__:h,popupResolver:P,popupCloser:O,loadRegisterSummary(){nsHttpClient.get(`/api/nexopos/v4/cash-registers/${this.settings.register.id}`).subscribe(e=>{this.register=e})},closePopup(){this.popupResolver({status:"failed",button:"close_popup"})},async closeCashRegister(e){try{const s=await new Promise((a,d)=>{Popup.show(x,{title:h("Close Register"),action:"close",identifier:"ns.cash-registers-closing",register:e,resolve:a,reject:d})});POS.unset("register"),this.popupResolver({button:"close_register",...s})}catch(s){throw s}},async cashIn(e){try{const s=await new Promise((a,d)=>{Popup.show(x,{title:h("Cash In"),action:"register-cash-in",register:e,identifier:"ns.cash-registers-cashing",resolve:a,reject:d})});this.popupResolver({button:"close_register",...s})}catch(s){throw s}},async cashOut(e){try{const s=await new Promise((a,d)=>{Popup.show(x,{title:h("Cash Out"),action:"register-cash-out",register:e,identifier:"ns.cash-registers-cashout",resolve:a,reject:d})});this.popupResolver({button:"close_register",...s})}catch(s){throw s}},async historyPopup(e){try{const s=await new Promise((a,d)=>{Popup.show(ke,{resolve:a,reject:d,register:e})})}catch(s){throw s}}}},Se={class:"shadow-lg w-95vw md:w-3/5-screen lg:w-2/4-screen ns-box"},Oe={class:"p-2 border-b ns-box-header flex items-center justify-between"},$e={key:0},je={class:"h-16 text-3xl elevation-surface info flex items-center justify-between px-3"},Ve={class:""},Be={class:"font-bold"},Ie={class:"h-16 text-3xl elevation-surface success flex items-center justify-between px-3"},He={class:""},Fe={class:"font-bold"},Ne={key:1,class:"h-32 ns-box-body border-b py-1 flex items-center justify-center"},Le={class:"grid grid-cols-2 text-primary"},Ae=t("i",{class:"las la-sign-out-alt text-6xl"},null,-1),ze={class:"text-xl font-bold"},De=t("i",{class:"las la-plus-circle text-6xl"},null,-1),Qe={class:"text-xl font-bold"},Te=t("i",{class:"las la-minus-circle text-6xl"},null,-1),Ue={class:"text-xl font-bold"},qe=t("i",{class:"las la-history text-6xl"},null,-1),Ee={class:"text-xl font-bold"};function Ye(e,s,a,d,i,r){const p=g("ns-close-button"),o=g("ns-spinner");return l(),c("div",Se,[t("div",Oe,[t("h3",null,n(r.__("Register Options")),1),t("div",null,[f(p,{onClick:s[0]||(s[0]=_=>r.closePopup())})])]),i.register.total_sale_amount!==void 0&&i.register.balance!==void 0?(l(),c("div",$e,[t("div",je,[t("span",Ve,n(r.__("Sales")),1),t("span",Be,n(e.nsCurrency(i.register.total_sale_amount)),1)]),t("div",Ie,[t("span",He,n(r.__("Balance")),1),t("span",Fe,n(e.nsCurrency(i.register.balance)),1)])])):u("",!0),i.register.total_sale_amount===void 0&&i.register.balance===void 0?(l(),c("div",Ne,[t("div",null,[f(o,{border:"4",size:"16"})])])):u("",!0),t("div",Le,[t("div",{onClick:s[1]||(s[1]=_=>r.closeCashRegister(i.register)),class:"border-r border-b py-4 ns-numpad-key info cursor-pointer px-2 flex items-center justify-center flex-col"},[Ae,t("h3",ze,n(r.__("Close")),1)]),t("div",{onClick:s[2]||(s[2]=_=>r.cashIn(i.register)),class:"ns-numpad-key success border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col"},[De,t("h3",Qe,n(r.__("Cash In")),1)]),t("div",{onClick:s[3]||(s[3]=_=>r.cashOut(i.register)),class:"ns-numpad-key error border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col"},[Te,t("h3",Ue,n(r.__("Cash Out")),1)]),t("div",{onClick:s[4]||(s[4]=_=>r.historyPopup(i.register)),class:"ns-numpad-key info border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col"},[qe,t("h3",Ee,n(r.__("History")),1)])])])}var Ke=m(Re,[["render",Ye]]);const Me={data(){return{order:null,name:"",selectedRegister:null,orderSubscriber:null,settingsSubscriber:null}},watch:{},methods:{__:h,async openRegisterOptions(){try{(await new Promise((s,a)=>{Popup.show(Ke,{resolve:s,reject:a})})).button==="close_register"&&(delete this.settings.register,POS.settings.next(this.settings),POS.reset())}catch(e){Object.keys(e).length>0&&y.error(e.message).subscribe()}},registerInitialQueue(){POS.initialQueue.push(async()=>{try{const e=await new Promise((s,a)=>{this.settings.register===void 0&&Popup.show(oe,{resolve:s,reject:a})});return POS.set("register",e.data.register),this.setRegister(e.data.register),e}catch(e){throw e}})},setButtonName(){if(this.settings.register===void 0)return this.name=h("Cash Register");this.name=h("Cash Register : {register}").replace("{register}",this.settings.register.name)},setRegister(e){if(e!==void 0){const s=POS.order.getValue();s.register_id=e.id,POS.order.next(s)}}},destroyed(){this.orderSubscriber.unsubscribe(),this.settingsSubscriber.unsubscribe()},mounted(){this.registerInitialQueue(),this.orderSubscriber=POS.order.subscribe(e=>{this.order=e}),this.settingsSubscriber=POS.settings.subscribe(e=>{this.settings=e,this.setRegister(this.settings.register),this.setButtonName()})}},We={class:"ns-button default"},Ge=t("i",{class:"mr-1 text-xl las la-cash-register"},null,-1);function Je(e,s,a,d,i,r){return l(),c("div",We,[t("button",{onClick:s[0]||(s[0]=p=>r.openRegisterOptions()),class:"rounded shadow flex-shrink-0 h-12 flex items-center px-2 py-1 text-sm"},[Ge,t("span",null,n(i.name),1)])])}var ts=m(Me,[["render",Je]]);export{ts as default};
