import{b as q,f as M}from"./components-3ca306d0.js";import{c as T}from"./npm~@vue~runtime-dom_-9455b728.js";import F from"./ns-alert-popup-be66b889.js";import{n as x,d as O,b as z,c as N}from"./ns-prompt-popup-07b67b26.js";import{n as B,a as H}from"./ns-orders-preview-popup-4ce9b823.js";import{n as W}from"./ns-procurement-quantity-8d07400f.js";import{_ as u,n as D}from"./currency-dc6217f5.js";import{b as v,P as U,c as g,a as E}from"./bootstrap-46bb2692.js";import"./npm~@dicebear~avatars_-24df7cd3.js";import"./npm~@dicebear~avatars-avataaars-sprites_-796ded10.js";import"./npm~moment-a9aaa855.js";import"./npm~vue2-daterange-picker-c3e32574.js";import"./npm~vuedraggable-b77cc769.js";import"./npm~vue-upload-component-5c82cdcf.js";import"./npm~lodash-3db1c062.js";import{_ as A}from"./_plugin-vue_export-helper-c27b6911.js";import{an as p,af as d,G as c,F as P,H as e,c as m,al as j,z as S,aH as w,A as h,M as k}from"./npm~@vue~runtime-core_-29a19feb.js";import{V as a,z as L}from"./npm~@vue~shared_-951a29c4.js";import{y as R}from"./npm~@vue~reactivity_-beabd60a.js";import"./ns-avatar-image-e829aee2.js";import"./npm~rxjs-eeb06f17.js";import"./npm~tslib-8dbab242.js";import"./npm~@ckeditor~ckeditor5-vue_-f12da425.js";import"./npm~@ckeditor~ckeditor5-build-classic_-b5d88964.js";import"./npm~vue-3512c1bf.js";import"./npm~@vue~compiler-dom_-614ecb28.js";import"./npm~@vue~compiler-core_-eb33010d.js";import"./npm~numeral-304d6dd9.js";import"./npm~currency.js-57f74176.js";import"./npm~laravel-echo-0c2ba8ed.js";import"./npm~pusher-js-bbfae226.js";import"./npm~axios-c24e582b.js";import"./npm~chart.js-3fed1729.js";import"./npm~rx-f450d610.js";import"./npm~@wordpress~hooks_-bd0b7221.js";import"./npm~mathjs-b10bd4cd.js";import"./npm~@babel~runtime_-9313f80d.js";import"./npm~decimal.js-d133ee8e.js";import"./npm~complex.js-dc0d19c5.js";import"./npm~fraction.js-cb0643cb.js";import"./npm~typed-function-de33f2d8.js";import"./npm~seedrandom-37239647.js";import"./npm~javascript-natural-sort-11e7fc54.js";import"./npm~escape-latex-404addb9.js";import"./npm~pure-color-28f75675.js";import"./npm~svgson-59868252.js";import"./npm~deep-rename-keys-9802c842.js";import"./npm~kind-of-f578382b.js";import"./npm~is-buffer-793dba8c.js";import"./npm~rename-keys-8dab041c.js";import"./npm~xml-reader-1f1b3f66.js";import"./npm~eventemitter3-e2795b41.js";import"./npm~xml-lexer-a4e87e97.js";import"./npm~sortablejs-1952ed83.js";const G={name:"ns-products-convertion",props:["popup","unitQuantity","product"],data(){return{unitQuantities:[],isLoading:!1,unitPair:{from:{unit:{},unitQuantity:{},selected:!0,quantity:0,realQuantity:0,fields:[{label:u("Assigned Unit"),name:"assigned_unit",value:"",type:"select",options:[]}]},to:{unit:{},unitQuantity:{},selected:!1,quantity:0,fields:[{label:u("Assigned Unit"),name:"assigned_unit",value:"",type:"select",options:[]}]}},selected:""}},mounted(){this.loadProductQuantities(),console.log(this)},methods:{__:u,async submitConvertion(){if(this.unitPair.from.quantity===0)return v.error(u("The quantity should be greater than 0")).subscribe();if(Math.floor(this.unitPair.to.quantity)===0)return v.error(u(`The provided quantity can't result in any convertion for unit "{destination}"`).replace("{destination}",this.unitPair.to.unit.name)).subscribe();if(this.unitPair.from.quantity!==this.unitPair.from.realQuantity)try{const i=await new Promise((t,s)=>{U.show(x,{title:u("Conversion Warning"),message:u("Only {quantity}({source}) can be converted to {destinationCount}({destination}). Would you like to proceed ?").replace("{quantity}",this.unitPair.from.realQuantity).replace("{destinationCount}",Math.floor(this.unitPair.to.quantity)).replace("{source}",this.unitPair.from.unit.name).replace("{destination}",this.unitPair.to.unit.name),onAction:l=>{l?t(!0):s(!1)}})});return this.proceedConversionSubmissions()}catch{return}try{const i=await new Promise((t,s)=>{U.show(x,{title:u("Confirm Conversion"),message:u("You're about to convert {quantity}({source}) to {destinationCount}({destination}). Would you like to proceed?").replace("{quantity}",this.unitPair.from.quantity).replace("{destinationCount}",Math.floor(this.unitPair.to.quantity)).replace("{source}",this.unitPair.from.unit.name).replace("{destination}",this.unitPair.to.unit.name),onAction:l=>{l?t(!0):s(!1)}})});return this.proceedConversionSubmissions()}catch{return}},proceedConversionSubmissions(){this.isLoading=!0,nsHttpClient.post(`/api/products/${this.unitQuantity.product_id}/units/conversion`,{from:this.unitPair.from.unit.id,to:this.unitPair.to.unit.id,quantity:this.unitPair.from.realQuantity}).subscribe({next:i=>(this.isLoading=!1,this.popup.close(),this.popup.params.resolve(i),g.success(u("Conversion Successful"),u("The product {product} has been converted successfully.").replace("{product}",this.product.name))),error:i=>(this.isLoading=!1,this.popup.params.reject(i),g.error(u("An error occured"),i.message||u("An error occured while converting the product {product}").replace("{product}",this.product.name)))})},handlePairUnitUpdated(i){const t=this.selectedUnitPair();t.unitQuantity=this.unitQuantities.filter(l=>l.unit.id===i.value)[0],t.unit=t.unitQuantity.unit,t.fields[0].value=i.value;const s=t===this.unitPair.from?this.unitPair.to:this.unitPair.from;s.unit.id===t.unit.id&&(s.unitQuantity=this.unitQuantities.filter(l=>l.unit.id!==t.unit.id)[0],s.unit=s.unitQuantity.unit,s.fields[0].value=s.unit.id),this.updateFromPairQuantity(this.unitPair.from.quantity)},updateFromPairQuantity(i){i.length===0&&(i=0),i>this.unitPair.from.unitQuantity.quantity&&(i=this.unitPair.from.unitQuantity.quantity,v.info(u("The quantity has been set to the maximum available")).subscribe()),this.unitPair.from.quantity=parseFloat(i);const t=this.unitQuantities.filter(o=>o.unit.base_unit)[0];if(t.length===0)return g.error(u("An error occured"),u("The product {product} has no base unit").replace("{product}",this.product.name));const l=this.unitPair.from.quantity*this.unitPair.from.unit.value*t.unit.value/this.unitPair.to.unit.value;this.unitPair.from.unit.value<this.unitPair.to.unit.value?this.unitPair.from.realQuantity=Math.floor(l)*this.unitPair.to.unit.value:this.unitPair.from.realQuantity=this.unitPair.from.quantity,this.unitPair.to.quantity=l},switchPair(){const i=this.unitPair.from.unit,t=this.unitPair.to.unit;this.unitPair.from.unit=t,this.unitPair.from.unitQuantity=this.unitQuantities.filter(s=>s.unit.id===t.id)[0],this.unitPair.from.quantity=Math.floor(this.unitPair.to.quantity),this.unitPair.to.unit=i,this.unitPair.to.unitQuantity=this.unitQuantities.filter(s=>s.unit.id===i.id)[0],this.updateFromPairQuantity(this.unitPair.from.quantity)},selectedUnitPair(){return this.unitPair[this.unitPair.from.selected?"from":"to"]},setVisible(i,t){const s=t==="from"?"to":"from";i[t].selected=!0,i[s].selected=!1},loadProductQuantities(){nsHttpClient.get("/api/products/"+this.unitQuantity.product_id+"/units/quantities").subscribe({next:i=>{this.unitQuantities=i,this.unitPair.from.unit=this.unitQuantity.unit,this.unitPair.from.unitQuantity=this.unitQuantity,this.unitPair.from.fields[0].value=this.unitQuantity.unit.id,this.unitPair.from.fields[0].options=i.map(t=>({label:t.unit.name,value:t.unit.id})),this.unitPair.to.unit=i.filter(t=>t.unit.id!==this.unitQuantity.unit.id)[0].unit,this.unitPair.to.unitQuantity=i.filter(t=>t.unit.id!==this.unitQuantity.unit.id)[0],this.unitPair.to.fields[0].value=this.unitPair.to.unit.id,this.unitPair.to.fields[0].options=i.map(t=>({label:t.unit.name,value:t.unit.id}))}})}}},I={class:"shadow-lg w-6/7-screen lg:w-3/5-screen ns-box overflow-hidden flex flex-col"},Y={class:"p-2 border-b ns-box-header text-primary text-center font-medium flex justify-between items-center"},J={class:"relative"},K={class:"border-b border-box-edge"},X={class:"flex"},Z={class:"font-bold text-3xl"},$={class:"border-r border-box-edge relative"},tt=e("i",{class:"las la-exchange-alt text-3xl"},null,-1),it=[tt],et={class:"font-bold text-3xl"},nt={class:"p-2 border-b border-box-edge"},st={class:""},ot={key:0,class:"top-0 left-0 absolute h-full w-full flex items-center justify-center",style:{background:"rgb(121 121 121 / 20%)"}},rt={key:1,class:"flex items-center h-full justify-center"};function ut(i,t,s,l,o,n){const _=p("ns-close-button"),b=p("ns-field"),y=p("ns-numpad"),f=p("ns-spinner");return d(),c("div",I,[o.unitQuantities.length>0?(d(),c(P,{key:0},[e("div",Y,[e("div",null,a(n.__("Unit Conversion : {product}").replace("{product}",s.product.name)),1),e("div",null,[m(_,{onClick:t[0]||(t[0]=r=>s.popup.close())})])]),e("div",J,[e("div",K,[e("div",X,[e("div",{class:L(["p-2 w-full md:w-1/2 flex flex-col items-center justify-center",o.unitPair.from.selected?"bg-info-primary text-white":""]),onClick:t[1]||(t[1]=r=>n.setVisible(o.unitPair,"from"))},[e("span",null,a(o.unitPair.from.unit.name),1),e("h3",Z,a(o.unitPair.from.quantity),1)],2),e("div",$,[e("div",{class:"rounded-full h-12 w-12 flex items-center justify-center absolute shadow bg-input-button p-2",onClick:t[2]||(t[2]=r=>n.switchPair()),style:{position:"absolute",left:"-22px",top:"14px"}},it)]),e("div",{class:L(["p-2 w-full md:w-1/2 flex flex-col items-center justify-center",o.unitPair.to.selected?"bg-info-primary text-white":""]),onClick:t[3]||(t[3]=r=>n.setVisible(o.unitPair,"to"))},[e("span",null,a(o.unitPair.to.unit.name),1),e("h3",et,a(Math.floor(o.unitPair.to.quantity)),1)],2)])]),e("div",nt,[(d(!0),c(P,null,j(n.selectedUnitPair().fields,r=>(d(),S(b,{onChange:t[4]||(t[4]=C=>n.handlePairUnitUpdated(C)),field:r},null,8,["field"]))),256))]),e("div",st,[m(y,{onNext:t[6]||(t[6]=r=>n.submitConvertion()),value:o.unitPair.from.quantity,onChanged:t[7]||(t[7]=r=>n.updateFromPairQuantity(r))},{"numpad-footer":w(()=>[e("div",{onClick:t[5]||(t[5]=r=>n.updateFromPairQuantity(o.unitPair.from.unitQuantity.quantity)),class:"w-full ns-numpad-key h-24 font-bold flex items-center justify-center cursor-pointer col-span-3"},a(n.__("Convert {quantity} available").replace("{quantity}",o.unitPair.from.unitQuantity.quantity)),1)]),_:1},8,["value"])]),o.isLoading?(d(),c("div",ot,[m(f,{size:"24"})])):h("",!0)])],64)):h("",!0),o.unitQuantities.length===0?(d(),c("div",rt,[m(f)])):h("",!0)])}const at=A(G,[["render",ut]]),lt={name:"ns-products-preview",props:["popup","product"],computed:{product(){return this.popup.params.product}},methods:{__:u,nsCurrency:D,changeActiveTab(i){this.active=i,this.active==="units-quantities"&&this.loadProductQuantities()},loadProductQuantities(){console.log("is loadinfg"),this.hasLoadedUnitQuantities=!1,E.get(`/api/products/${this.product.id}/units/quantities`).subscribe({next:i=>{this.unitQuantities=i,this.hasLoadedUnitQuantities=!0}})},async convert(i,t){try{const s=await new Promise((l,o)=>{Popup.show(at,{unitQuantity:i,product:t,resolve:l,reject:o})});this.loadProductQuantities()}catch(s){console.log({exception:s})}}},data(){return{active:"units-quantities",unitQuantities:[],hasLoadedUnitQuantities:!1}},mounted(){this.loadProductQuantities()}},dt={class:"shadow-lg w-6/7-screen lg:w-3/5-screen h-6/7-screen lg:h-4/5-screen ns-box overflow-hidden flex flex-col"},ct={class:"p-2 border-b ns-box-header text-primary text-center font-medium flex justify-between items-center"},pt={class:"flex-auto overflow-y-auto ns-box-body"},mt={class:"p-2"},ht={key:0,class:"table ns-table w-full"},ft={class:"p-1 border"},Pt={width:"150",class:"text-right p-1 border"},_t={width:"150",class:"text-right p-1 border"},bt={width:"150",class:"text-right p-1 border"},yt={class:"p-1 border text-left"},vt=["onClick"],gt={class:"p-1 border text-right"},xt={class:"p-1 border text-right"},wt={class:"p-1 border text-right"};function Qt(i,t,s,l,o,n){const _=p("ns-close-button"),b=p("ns-spinner"),y=p("ns-tabs-item"),f=p("ns-tabs");return d(),c("div",dt,[e("div",ct,[e("div",null,a(n.__("Previewing :"))+" "+a(n.product.name),1),e("div",null,[m(_,{onClick:t[0]||(t[0]=r=>s.popup.close())})])]),e("div",pt,[e("div",mt,[m(f,{active:o.active,onActive:t[1]||(t[1]=r=>n.changeActiveTab(r))},{default:w(()=>[m(y,{label:n.__("Units & Quantities"),identifier:"units-quantities"},{default:w(()=>[o.hasLoadedUnitQuantities?(d(),c("table",ht,[e("thead",null,[e("tr",null,[e("th",ft,a(n.__("Unit")),1),e("th",Pt,a(n.__("Sale Price")),1),e("th",_t,a(n.__("Wholesale Price")),1),e("th",bt,a(n.__("Quantity")),1)])]),e("tbody",null,[(d(!0),c(P,null,j(o.unitQuantities,r=>(d(),c("tr",{key:r.id},[e("td",yt,[k(a(r.unit.name)+" ",1),n.product.rawType==="materialized"&&n.product.rawStockManagement==="enabled"?(d(),c(P,{key:0},[k(" — "),e("a",{onClick:C=>n.convert(r,n.product),class:"text-sm text-info-secondary hover:underline border-dashed",href:"javascript:void(0)"},a(n.__("Convert")),9,vt)],64)):h("",!0)]),e("td",gt,a(n.nsCurrency(r.sale_price)),1),e("td",xt,a(n.nsCurrency(r.wholesale_price)),1),e("td",wt,a(r.quantity),1)]))),128))])])):h("",!0),o.hasLoadedUnitQuantities?h("",!0):(d(),S(b,{key:1,size:"16",border:"4"}))]),_:1},8,["label"])]),_:1},8,["active"])])])])}const Ct=A(lt,[["render",Qt]]),V={nsOrderPreview:B,nsProductPreview:Ct,nsAlertPopup:F,nsConfirmPopup:x,nsPromptPopup:O,nsMediaPopup:M,nsProcurementQuantity:W,nsOrdersRefund:H,nsSelectPopup:z,nsPOSLoadingPopup:N};for(let i in V)window[i]=V[i];const Q=T({data(){return{popups:[],defaultClass:"absolute top-0 left-0 w-full h-full items-center flex overflow-y-auto justify-center is-popup"}},mounted(){nsState.subscribe(i=>{i.popups!==void 0&&(this.popups=R(i.popups),this.$forceUpdate())})},methods:{closePopup(i,t){Object.values(t.target.classList).includes("is-popup")&&i.config!==void 0&&[void 0,!0].includes(i.config.closeOnOverlayClick)&&(t.stopPropagation(),i.close())},preventPropagation(i){i.stopImmediatePropagation()}}});for(let i in q)Q.component(i,q[i]);document.addEventListener("DOMContentLoaded",()=>{Q.mount("#dashboard-popups"),window.nsPopups=Q});
