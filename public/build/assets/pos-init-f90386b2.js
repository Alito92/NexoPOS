var Q=Object.defineProperty;var R=(p,e,t)=>e in p?Q(p,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[e]=t;var l=(p,e,t)=>(R(p,typeof e!="symbol"?e+"":e,t),t);import{_ as f}from"./preload-helper-41c905a7.js";import{P as U}from"./product-quantity-adaff45b.js";import{n as b,a as h,P as V,b as m,c as L,d as W,T as E}from"./bootstrap-414293d9.js";import{_ as u,n as S,a as O}from"./currency-47ec5b79.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";import{ae as F,a6 as v,z as P,A as T,F as D,ac as j,y as A,c as z,I as y}from"./npm~@vue~runtime-core_-ff0bdc0c.js";import{U as C}from"./npm~@vue~shared_-82b01912.js";import{h as N}from"./npm~moment-fbc5633a.js";import{P as H}from"./print-3c0412fa.js";import{B as x}from"./npm~rxjs-a7e91008.js";import{c as _}from"./npm~mathjs-1dff8408.js";import"./ns-numpad-plus-f3ffaa01.js";import"./npm~lodash-f7a36ac5.js";import"./npm~@ckeditor~ckeditor5-build-classic_-a8abd726.js";import"./npm~laravel-echo-7ac8f47a.js";import"./npm~pusher-js-7b18aad5.js";import"./npm~axios-4a70c6fc.js";import"./npm~chart.js-3fed1729.js";import"./npm~vue-6a0d7c4c.js";import"./npm~@vue~runtime-dom_-a668b91e.js";import"./npm~@vue~reactivity_-481192b6.js";import"./npm~@vue~compiler-dom_-04241bb4.js";import"./npm~@vue~compiler-core_-2a2ce8c7.js";import"./npm~rx-1641e2f8.js";import"./npm~@wordpress~hooks_-18172e20.js";import"./npm~numeral-faf61dd1.js";import"./npm~currency.js-57f74176.js";import"./npm~tslib-f3101d7c.js";import"./npm~@babel~runtime_-34ca84e8.js";import"./npm~decimal.js-d133ee8e.js";import"./npm~complex.js-15c479db.js";import"./npm~fraction.js-52b397f9.js";import"./npm~typed-function-e88d1f37.js";import"./npm~seedrandom-b246f2f9.js";import"./npm~javascript-natural-sort-11e7fc54.js";import"./npm~escape-latex-404addb9.js";const G={props:["popup"],data(){return{unitsQuantities:[],loadsUnits:!1,options:null,optionsSubscriber:null}},beforeDestroy(){this.optionsSubscriber.unsubscribe()},mounted(){this.optionsSubscriber=POS.options.subscribe(p=>{this.options=p}),this.popup.params.product.$original().selectedUnitQuantity!==void 0?this.selectUnit(this.popup.params.product.$original().selectedUnitQuantity):this.popup.params.product.$original().unit_quantities!==void 0&&this.popup.params.product.$original().unit_quantities.length===1?this.selectUnit(this.popup.params.product.$original().unit_quantities[0]):(this.loadsUnits=!0,this.loadUnits())},methods:{__:u,nsCurrency:S,displayRightPrice(p){return POS.getSalePrice(p,this.popup.params.product.$original())},loadUnits(){b.get(`/api/products/${this.popup.params.product.$original().id}/units/quantities`).subscribe(p=>{if(p.length===0)return this.popup.close(),h.error(u("This product doesn't have any unit defined for selling.")).subscribe();this.unitsQuantities=p,this.unitsQuantities.length===1&&this.selectUnit(this.unitsQuantities[0])})},selectUnit(p){if(p.unit===null)return h.error(u('The unit attached to this product is missing or not assigned. Please review the "Unit" tab for this product.')).subscribe(),this.popup.close();this.popup.params.resolve({unit_quantity_id:p.id,unit_name:p.unit.name,$quantities:()=>p}),this.popup.close()}}},M={class:"h-full w-full flex items-center justify-center",id:"ns-units-selector"},K={key:0,class:"ns-box w-2/3-screen lg:w-1/3-screen overflow-hidden flex flex-col"},Y={id:"header",class:"h-16 flex justify-center items-center flex-shrink-0"},J={class:"font-bold text-primary"},X={key:0,class:"grid grid-flow-row grid-cols-2 overflow-y-auto"},Z=["onClick"],ee={class:"h-40 w-full flex items-center justify-center overflow-hidden"},te=["src","alt"],se={key:1,class:"h-40 flex items-center justify-center"},ie=T("i",{class:"las la-image text-primary text-6xl"},null,-1),re=[ie],ne={class:"h-0 w-full"},oe={class:"relative w-full flex items-center justify-center -top-10 h-20 py-2 flex-col overlay"},ae={class:"font-bold text-primary py-2 text-center"},ue={class:"text-sm font-medium text-primary"},ce={key:1,class:"h-56 flex items-center justify-center"};function le(p,e,t,s,i,o){const r=F("ns-spinner");return v(),P("div",M,[i.unitsQuantities.length>0?(v(),P("div",K,[T("div",Y,[T("h3",J,C(o.__("Choose Selling Unit")),1)]),i.unitsQuantities.length>0?(v(),P("div",X,[(v(!0),P(D,null,j(i.unitsQuantities,n=>(v(),P("div",{onClick:c=>o.selectUnit(n),key:n.id,class:"ns-numpad-key info cursor-pointer border flex-shrink-0 flex flex-col items-center justify-center"},[T("div",ee,[n.preview_url?(v(),P("img",{key:0,src:n.preview_url,class:"object-cover h-full",alt:n.unit.name},null,8,te)):A("",!0),n.preview_url?A("",!0):(v(),P("div",se,re))]),T("div",ne,[T("div",oe,[T("h3",ae,C(n.unit.name)+" ("+C(n.quantity)+")",1),T("p",ue,C(o.nsCurrency(o.displayRightPrice(n))),1)])])],8,Z))),128))])):A("",!0)])):A("",!0),i.unitsQuantities.length===0?(v(),P("div",ce,[z(r)])):A("",!0)])}const de=B(G,[["render",le]]);class _e{constructor(e){this.product=e}run(){return new Promise((e,t)=>{const s=this.product;V.show(de,{resolve:e,reject:t,product:s})})}}class pe{constructor(){l(this,"screenIs");this.detect()}detect(){window.innerWidth<544?this.screenIs="xs":window.innerWidth>=544&&window.innerWidth<768?this.screenIs="sm":window.innerWidth>=768&&window.innerWidth<992?this.screenIs="md":window.innerWidth>=992&&window.innerWidth<1200?this.screenIs="lg":window.innerWidth>=1200&&(this.screenIs="xl")}is(e){return e===void 0?this.screenIs:this.screenIs===e}}const he=window.nsPosDashboardButton=y(()=>f(()=>import("./ns-pos-dashboard-button-bda8551d.js"),["./ns-pos-dashboard-button-bda8551d.js","./currency-47ec5b79.js","./npm~numeral-faf61dd1.js","./npm~@ckeditor~ckeditor5-build-classic_-a8abd726.js","./npm~currency.js-57f74176.js","./_plugin-vue_export-helper-c27b6911.js","./npm~@vue~runtime-core_-ff0bdc0c.js","./npm~@vue~reactivity_-481192b6.js","./npm~@vue~shared_-82b01912.js"],import.meta.url)),me=window.nsPosPendingOrderButton=y(()=>f(()=>import("./ns-pos-pending-orders-button-1b001f23.js"),["./ns-pos-pending-orders-button-1b001f23.js","./bootstrap-414293d9.js","./npm~lodash-f7a36ac5.js","./npm~@ckeditor~ckeditor5-build-classic_-a8abd726.js","./npm~laravel-echo-7ac8f47a.js","./npm~pusher-js-7b18aad5.js","./npm~axios-4a70c6fc.js","./npm~chart.js-3fed1729.js","./npm~rxjs-a7e91008.js","./npm~tslib-f3101d7c.js","./npm~moment-fbc5633a.js","./npm~vue-6a0d7c4c.js","./npm~@vue~runtime-dom_-a668b91e.js","./npm~@vue~runtime-core_-ff0bdc0c.js","./npm~@vue~reactivity_-481192b6.js","./npm~@vue~shared_-82b01912.js","./npm~@vue~compiler-dom_-04241bb4.js","./npm~@vue~compiler-core_-2a2ce8c7.js","./npm~rx-1641e2f8.js","./npm~@wordpress~hooks_-18172e20.js","./currency-47ec5b79.js","./npm~numeral-faf61dd1.js","./npm~currency.js-57f74176.js","./npm~mathjs-1dff8408.js","./npm~@babel~runtime_-34ca84e8.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-15c479db.js","./npm~fraction.js-52b397f9.js","./npm~typed-function-e88d1f37.js","./npm~seedrandom-b246f2f9.js","./npm~javascript-natural-sort-11e7fc54.js","./npm~escape-latex-404addb9.js","./ns-pos-confirm-popup-919c695d.js","./_plugin-vue_export-helper-c27b6911.js"],import.meta.url)),ge=window.nsPosOrderTypeButton=y(()=>f(()=>import("./ns-pos-order-type-button-cf16d73c.js"),["./ns-pos-order-type-button-cf16d73c.js","./bootstrap-414293d9.js","./npm~lodash-f7a36ac5.js","./npm~@ckeditor~ckeditor5-build-classic_-a8abd726.js","./npm~laravel-echo-7ac8f47a.js","./npm~pusher-js-7b18aad5.js","./npm~axios-4a70c6fc.js","./npm~chart.js-3fed1729.js","./npm~rxjs-a7e91008.js","./npm~tslib-f3101d7c.js","./npm~moment-fbc5633a.js","./npm~vue-6a0d7c4c.js","./npm~@vue~runtime-dom_-a668b91e.js","./npm~@vue~runtime-core_-ff0bdc0c.js","./npm~@vue~reactivity_-481192b6.js","./npm~@vue~shared_-82b01912.js","./npm~@vue~compiler-dom_-04241bb4.js","./npm~@vue~compiler-core_-2a2ce8c7.js","./npm~rx-1641e2f8.js","./npm~@wordpress~hooks_-18172e20.js","./currency-47ec5b79.js","./npm~numeral-faf61dd1.js","./npm~currency.js-57f74176.js","./npm~mathjs-1dff8408.js","./npm~@babel~runtime_-34ca84e8.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-15c479db.js","./npm~fraction.js-52b397f9.js","./npm~typed-function-e88d1f37.js","./npm~seedrandom-b246f2f9.js","./npm~javascript-natural-sort-11e7fc54.js","./npm~escape-latex-404addb9.js","./ns-pos-order-type-popup-a22dae17.js","./_plugin-vue_export-helper-c27b6911.js"],import.meta.url)),xe=window.nsPosCustomersButton=y(()=>f(()=>import("./ns-pos-customers-button-ad0a3a91.js"),["./ns-pos-customers-button-ad0a3a91.js","./preload-helper-41c905a7.js","./bootstrap-414293d9.js","./npm~lodash-f7a36ac5.js","./npm~@ckeditor~ckeditor5-build-classic_-a8abd726.js","./npm~laravel-echo-7ac8f47a.js","./npm~pusher-js-7b18aad5.js","./npm~axios-4a70c6fc.js","./npm~chart.js-3fed1729.js","./npm~rxjs-a7e91008.js","./npm~tslib-f3101d7c.js","./npm~moment-fbc5633a.js","./npm~vue-6a0d7c4c.js","./npm~@vue~runtime-dom_-a668b91e.js","./npm~@vue~runtime-core_-ff0bdc0c.js","./npm~@vue~reactivity_-481192b6.js","./npm~@vue~shared_-82b01912.js","./npm~@vue~compiler-dom_-04241bb4.js","./npm~@vue~compiler-core_-2a2ce8c7.js","./npm~rx-1641e2f8.js","./npm~@wordpress~hooks_-18172e20.js","./currency-47ec5b79.js","./npm~numeral-faf61dd1.js","./npm~currency.js-57f74176.js","./npm~mathjs-1dff8408.js","./npm~@babel~runtime_-34ca84e8.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-15c479db.js","./npm~fraction.js-52b397f9.js","./npm~typed-function-e88d1f37.js","./npm~seedrandom-b246f2f9.js","./npm~javascript-natural-sort-11e7fc54.js","./npm~escape-latex-404addb9.js","./_plugin-vue_export-helper-c27b6911.js"],import.meta.url)),fe=window.nsPosResetButton=y(()=>f(()=>import("./ns-pos-reset-button-6a2eeb37.js"),["./ns-pos-reset-button-6a2eeb37.js","./bootstrap-414293d9.js","./npm~lodash-f7a36ac5.js","./npm~@ckeditor~ckeditor5-build-classic_-a8abd726.js","./npm~laravel-echo-7ac8f47a.js","./npm~pusher-js-7b18aad5.js","./npm~axios-4a70c6fc.js","./npm~chart.js-3fed1729.js","./npm~rxjs-a7e91008.js","./npm~tslib-f3101d7c.js","./npm~moment-fbc5633a.js","./npm~vue-6a0d7c4c.js","./npm~@vue~runtime-dom_-a668b91e.js","./npm~@vue~runtime-core_-ff0bdc0c.js","./npm~@vue~reactivity_-481192b6.js","./npm~@vue~shared_-82b01912.js","./npm~@vue~compiler-dom_-04241bb4.js","./npm~@vue~compiler-core_-2a2ce8c7.js","./npm~rx-1641e2f8.js","./npm~@wordpress~hooks_-18172e20.js","./currency-47ec5b79.js","./npm~numeral-faf61dd1.js","./npm~currency.js-57f74176.js","./npm~mathjs-1dff8408.js","./npm~@babel~runtime_-34ca84e8.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-15c479db.js","./npm~fraction.js-52b397f9.js","./npm~typed-function-e88d1f37.js","./npm~seedrandom-b246f2f9.js","./npm~javascript-natural-sort-11e7fc54.js","./npm~escape-latex-404addb9.js","./_plugin-vue_export-helper-c27b6911.js","./ns-pos-confirm-popup-919c695d.js","./npm~@dicebear~avatars_-e73ed2cc.js","./npm~pure-color-28f75675.js","./npm~svgson-a2b86d8a.js","./npm~omit-deep-3a616dcc.js","./npm~is-plain-object-01248184.js","./npm~isobject-2e03973b.js","./npm~isarray-980812a4.js","./npm~unset-value-cf896816.js","./npm~has-value-859045a0.js","./npm~has-values-79b61d1f.js","./npm~get-value-efae0488.js","./npm~deep-rename-keys-9802c842.js","./npm~kind-of-f578382b.js","./npm~is-buffer-793dba8c.js","./npm~rename-keys-8dab041c.js","./npm~xml-reader-1784d248.js","./npm~eventemitter3-c7e30f9c.js","./npm~xml-lexer-6516179a.js","./npm~@dicebear~avatars-avataaars-sprites_-e47afe24.js","./ns-switch-0a4d4345.js","./npm~@ckeditor~ckeditor5-vue_-b5744b68.js","./npm~vue2-daterange-picker-f17f6b76.js","./npm~vue2-daterange-picker-b4959dd3.css","./npm~vuedraggable-90a90e9d.js","./npm~sortablejs-9be29f79.js","./npm~vue-upload-component-9e5d4563.js"],import.meta.url)),ye=window.nsPosCashRegister=y(()=>f(()=>import("./ns-pos-registers-button-5c564693.js"),["./ns-pos-registers-button-5c564693.js","./bootstrap-414293d9.js","./npm~lodash-f7a36ac5.js","./npm~@ckeditor~ckeditor5-build-classic_-a8abd726.js","./npm~laravel-echo-7ac8f47a.js","./npm~pusher-js-7b18aad5.js","./npm~axios-4a70c6fc.js","./npm~chart.js-3fed1729.js","./npm~rxjs-a7e91008.js","./npm~tslib-f3101d7c.js","./npm~moment-fbc5633a.js","./npm~vue-6a0d7c4c.js","./npm~@vue~runtime-dom_-a668b91e.js","./npm~@vue~runtime-core_-ff0bdc0c.js","./npm~@vue~reactivity_-481192b6.js","./npm~@vue~shared_-82b01912.js","./npm~@vue~compiler-dom_-04241bb4.js","./npm~@vue~compiler-core_-2a2ce8c7.js","./npm~rx-1641e2f8.js","./npm~@wordpress~hooks_-18172e20.js","./currency-47ec5b79.js","./npm~numeral-faf61dd1.js","./npm~currency.js-57f74176.js","./npm~mathjs-1dff8408.js","./npm~@babel~runtime_-34ca84e8.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-15c479db.js","./npm~fraction.js-52b397f9.js","./npm~typed-function-e88d1f37.js","./npm~seedrandom-b246f2f9.js","./npm~javascript-natural-sort-11e7fc54.js","./npm~escape-latex-404addb9.js","./ns-pos-confirm-popup-919c695d.js","./_plugin-vue_export-helper-c27b6911.js","./ns-numpad-plus-f3ffaa01.js"],import.meta.url)),we=window.nsAlertPopup=y(()=>f(()=>import("./ns-alert-popup-883dcb0b.js"),["./ns-alert-popup-883dcb0b.js","./currency-47ec5b79.js","./npm~numeral-faf61dd1.js","./npm~@ckeditor~ckeditor5-build-classic_-a8abd726.js","./npm~currency.js-57f74176.js","./_plugin-vue_export-helper-c27b6911.js","./npm~@vue~runtime-core_-ff0bdc0c.js","./npm~@vue~reactivity_-481192b6.js","./npm~@vue~shared_-82b01912.js"],import.meta.url)),k=window.nsConfirmPopup=y(()=>f(()=>import("./ns-pos-confirm-popup-919c695d.js"),["./ns-pos-confirm-popup-919c695d.js","./currency-47ec5b79.js","./npm~numeral-faf61dd1.js","./npm~@ckeditor~ckeditor5-build-classic_-a8abd726.js","./npm~currency.js-57f74176.js","./bootstrap-414293d9.js","./npm~lodash-f7a36ac5.js","./npm~laravel-echo-7ac8f47a.js","./npm~pusher-js-7b18aad5.js","./npm~axios-4a70c6fc.js","./npm~chart.js-3fed1729.js","./npm~rxjs-a7e91008.js","./npm~tslib-f3101d7c.js","./npm~moment-fbc5633a.js","./npm~vue-6a0d7c4c.js","./npm~@vue~runtime-dom_-a668b91e.js","./npm~@vue~runtime-core_-ff0bdc0c.js","./npm~@vue~reactivity_-481192b6.js","./npm~@vue~shared_-82b01912.js","./npm~@vue~compiler-dom_-04241bb4.js","./npm~@vue~compiler-core_-2a2ce8c7.js","./npm~rx-1641e2f8.js","./npm~@wordpress~hooks_-18172e20.js","./npm~mathjs-1dff8408.js","./npm~@babel~runtime_-34ca84e8.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-15c479db.js","./npm~fraction.js-52b397f9.js","./npm~typed-function-e88d1f37.js","./npm~seedrandom-b246f2f9.js","./npm~javascript-natural-sort-11e7fc54.js","./npm~escape-latex-404addb9.js","./_plugin-vue_export-helper-c27b6911.js"],import.meta.url));window.nsPOSLoadingPopup=y(()=>f(()=>import("./ns-pos-loading-popup-c5c20a52.js"),["./ns-pos-loading-popup-c5c20a52.js","./_plugin-vue_export-helper-c27b6911.js","./npm~@vue~runtime-core_-ff0bdc0c.js","./npm~@vue~reactivity_-481192b6.js","./npm~@vue~shared_-82b01912.js"],import.meta.url));const be=window.nsPromptPopup=y(()=>f(()=>import("./ns-prompt-popup-64b67141.js"),["./ns-prompt-popup-64b67141.js","./currency-47ec5b79.js","./npm~numeral-faf61dd1.js","./npm~@ckeditor~ckeditor5-build-classic_-a8abd726.js","./npm~currency.js-57f74176.js","./npm~@vue~runtime-dom_-a668b91e.js","./npm~@vue~runtime-core_-ff0bdc0c.js","./npm~@vue~reactivity_-481192b6.js","./npm~@vue~shared_-82b01912.js","./_plugin-vue_export-helper-c27b6911.js"],import.meta.url)),ve=window.nsLayawayPopup=y(()=>f(()=>import("./ns-pos-layaway-popup-cda068be.js"),["./ns-pos-layaway-popup-cda068be.js","./bootstrap-414293d9.js","./npm~lodash-f7a36ac5.js","./npm~@ckeditor~ckeditor5-build-classic_-a8abd726.js","./npm~laravel-echo-7ac8f47a.js","./npm~pusher-js-7b18aad5.js","./npm~axios-4a70c6fc.js","./npm~chart.js-3fed1729.js","./npm~rxjs-a7e91008.js","./npm~tslib-f3101d7c.js","./npm~moment-fbc5633a.js","./npm~vue-6a0d7c4c.js","./npm~@vue~runtime-dom_-a668b91e.js","./npm~@vue~runtime-core_-ff0bdc0c.js","./npm~@vue~reactivity_-481192b6.js","./npm~@vue~shared_-82b01912.js","./npm~@vue~compiler-dom_-04241bb4.js","./npm~@vue~compiler-core_-2a2ce8c7.js","./npm~rx-1641e2f8.js","./npm~@wordpress~hooks_-18172e20.js","./currency-47ec5b79.js","./npm~numeral-faf61dd1.js","./npm~currency.js-57f74176.js","./npm~mathjs-1dff8408.js","./npm~@babel~runtime_-34ca84e8.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-15c479db.js","./npm~fraction.js-52b397f9.js","./npm~typed-function-e88d1f37.js","./npm~seedrandom-b246f2f9.js","./npm~javascript-natural-sort-11e7fc54.js","./npm~escape-latex-404addb9.js","./_plugin-vue_export-helper-c27b6911.js"],import.meta.url)),Pe=window.nsPosShippingPopup=y(()=>f(()=>import("./ns-pos-shipping-popup-21450c6d.js"),["./ns-pos-shipping-popup-21450c6d.js","./bootstrap-414293d9.js","./npm~lodash-f7a36ac5.js","./npm~@ckeditor~ckeditor5-build-classic_-a8abd726.js","./npm~laravel-echo-7ac8f47a.js","./npm~pusher-js-7b18aad5.js","./npm~axios-4a70c6fc.js","./npm~chart.js-3fed1729.js","./npm~rxjs-a7e91008.js","./npm~tslib-f3101d7c.js","./npm~moment-fbc5633a.js","./npm~vue-6a0d7c4c.js","./npm~@vue~runtime-dom_-a668b91e.js","./npm~@vue~runtime-core_-ff0bdc0c.js","./npm~@vue~reactivity_-481192b6.js","./npm~@vue~shared_-82b01912.js","./npm~@vue~compiler-dom_-04241bb4.js","./npm~@vue~compiler-core_-2a2ce8c7.js","./npm~rx-1641e2f8.js","./npm~@wordpress~hooks_-18172e20.js","./currency-47ec5b79.js","./npm~numeral-faf61dd1.js","./npm~currency.js-57f74176.js","./npm~mathjs-1dff8408.js","./npm~@babel~runtime_-34ca84e8.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-15c479db.js","./npm~fraction.js-52b397f9.js","./npm~typed-function-e88d1f37.js","./npm~seedrandom-b246f2f9.js","./npm~javascript-natural-sort-11e7fc54.js","./npm~escape-latex-404addb9.js","./_plugin-vue_export-helper-c27b6911.js"],import.meta.url));let I=class{constructor(){l(this,"_cartButtons");l(this,"_products");l(this,"_breadcrumbs");l(this,"_customers");l(this,"_settings");l(this,"_types");l(this,"_orderTypeProcessQueue",[]);l(this,"_paymentsType");l(this,"_order");l(this,"_screen");l(this,"_holdPopupEnabled",!0);l(this,"_initialQueue",[]);l(this,"_options");l(this,"_responsive",new pe);l(this,"_visibleSection");l(this,"_isSubmitting",!1);l(this,"_processingAddQueue",!1);l(this,"_selectedPaymentType");l(this,"print");l(this,"defaultOrder",()=>({discount_type:null,title:"",discount:0,register_id:this.get("register")?this.get("register").id:void 0,discount_percentage:0,subtotal:0,total:0,coupons:[],total_coupons:0,tendered:0,note:"",note_visibility:"hidden",tax_group_id:void 0,tax_type:void 0,taxes:[],tax_groups:[],payment_status:void 0,customer_id:void 0,change:0,total_products:0,shipping:0,tax_value:0,products_exclusive_tax_value:0,products_inclusive_tax_value:0,total_tax_value:0,shipping_rate:0,shipping_type:void 0,customer:void 0,type:void 0,products:[],instalments:[],payments:[],addresses:{shipping:void 0,billing:void 0}}));l(this,"addToCartQueue",[_e,U]);this.initialize(),this.print=new H({urls:systemUrls,options:systemOptions})}get screen(){return this._screen}get visibleSection(){return this._visibleSection}get paymentsType(){return this._paymentsType}get selectedPaymentType(){return this._selectedPaymentType}get order(){return this._order}get types(){return this._types}get products(){return this._products}get customers(){return this._customers}get options(){return this._options}get orderTypeQueue(){return this._orderTypeProcessQueue}get settings(){return this._settings}get breadcrumbs(){return this._breadcrumbs}get initialQueue(){return this._initialQueue}get responsive(){return this._responsive}get processingAddQueue(){return this._processingAddQueue}get cartButtons(){return this._cartButtons}async reset(){this._isSubmitting=!1,this.order.next(this.defaultOrder()),this.products.next([]),this._customers.next([]),this._breadcrumbs.next([]),this._cartButtons.next({}),this.defineCurrentScreen(),this.setHoldPopupEnabled(!0),await this.processInitialQueue(),m.doAction("ns-after-cart-changed"),m.doAction("ns-after-cart-reset")}initialize(){this._products=new x([]),this._customers=new x([]),this._types=new x([]),this._breadcrumbs=new x([]),this._screen=new x(""),this._paymentsType=new x([]),this._visibleSection=new x("both"),this._options=new x({}),this._settings=new x({}),this._order=new x(this.defaultOrder()),this._selectedPaymentType=new x(null),this._cartButtons=new x({}),this._orderTypeProcessQueue=[{identifier:"handle.delivery-order",promise:e=>new Promise((t,s)=>e&&e.identifier==="delivery"?V.show(Pe,{resolve:t,reject:s}):t({status:"success",message:"Proceed"}))}],this.initialQueue.push(()=>new Promise((e,t)=>{const s=this.options.getValue(),i=this.order.getValue();return i.tax_type=s.ns_pos_tax_type,s.ns_pos_tax_group!==!1&&(i.tax_group_id=s.ns_pos_tax_group,this.order.next(i)),e({status:"success",message:"tax group assignated"})})),this.initialQueue.push(()=>new Promise((e,t)=>{const s=this.options.getValue();return this.order.getValue(),s.ns_customers_default!==!1&&b.get(`/api/customers/${s.ns_customers_default}`).subscribe({next:i=>{this.selectCustomer(i),e({status:"success",message:u("The customer has been loaded")})},error:i=>{L.error(u("An error has occured"),u("Unable to select the default customer. Looks like the customer no longer exists. Consider changing the default customer on the settings."),{actions:{readMore:{label:u("Read More"),onClick:o=>{o.close(),window.open("https://my.nexopos.com/en/documentation/troubleshooting/no-default-customer","_blank")}},close:{label:u("Close")}}}),t(i)}}),e({status:"success",message:"tax group assignated"})})),window.addEventListener("resize",()=>{this._responsive.detect(),this.defineCurrentScreen()}),window.onbeforeunload=()=>{if(this.products.getValue().length>0)return u("Some products has been added to the cart. Would youl ike to discard this order ?")},m.addAction("ns-after-cart-changed","listen-add-to-cart",()=>this.refreshCart()),this.types.subscribe(e=>{const t=Object.values(e).filter(s=>s.selected);if(t.length>0){const s=this.order.getValue();s.type=t[0],this.order.next(s)}}),window.addEventListener("resize",()=>{this._responsive.detect(),this.defineCurrentScreen()}),window.onbeforeunload=()=>{if(this.products.getValue().length>0)return u("Some products has been added to the cart. Would youl ike to discard this order ?")}}getSalePrice(e,t){return this.options.getValue().ns_pos_price_with_tax==="yes"?O(e.sale_price_with_tax):O(e.sale_price_without_tax)}getCustomPrice(e,t){return this.options.getValue().ns_pos_price_with_tax==="yes"?O(e.custom_price_with_tax):O(e.custom_price_without_tax)}getWholesalePrice(e,t){return this.options.getValue().ns_pos_price_with_tax==="yes"?O(e.wholesale_price_with_tax):O(e.wholesale_price_without_tax)}setHoldPopupEnabled(e=!0){this._holdPopupEnabled=e}getHoldPopupEnabled(){return this._holdPopupEnabled}async processInitialQueue(){for(let e in this._initialQueue)try{const t=await this._initialQueue[e]()}catch(t){h.error(t.message).subscribe()}}removeCoupon(e){const t=this.order.getValue(),s=t.coupons,i=s.indexOf(e);s.splice(i,1),t.coupons=s,this.order.next(t)}pushCoupon(e){const t=this.order.getValue();t.coupons.forEach(s=>{if(s.code===e.code){const i=u("This coupon is already added to the cart");throw h.error(i).subscribe(),i}}),t.coupons.push(e),this.order.next(t),this.refreshCart()}get header(){const e={buttons:{nsPosDashboardButton:he,nsPosPendingOrderButton:me,nsPosOrderTypeButton:ge,nsPosCustomersButton:xe,nsPosResetButton:fe}};return this.options.getValue().ns_pos_registers_enabled==="yes"&&(e.buttons.nsPosCashRegister=ye),m.doAction("ns-pos-header",e),e}defineOptions(e){this._options.next(e)}defineCurrentScreen(){this._visibleSection.next(["xs","sm"].includes(this._responsive.is())?"grid":"both"),this._screen.next(this._responsive.is())}changeVisibleSection(e){["both","cart","grid"].includes(e)&&(["cart","both"].includes(e)&&this.refreshCart(),this._visibleSection.next(e))}addPayment(e){if(e.value>0){const t=this._order.getValue();return t.payments.push(e),this._order.next(t),this.computePaid()}return h.error("Invalid amount.").subscribe()}removePayment(e){if(e.id!==void 0)return h.error(u("Unable to delete a payment attached to the order.")).subscribe();const t=this._order.getValue(),s=t.payments.indexOf(e);t.payments.splice(s,1),this._order.next(t),W.emit({identifier:"ns.pos.remove-payment",value:e}),this.updateCustomerAccount(e),this.computePaid()}updateCustomerAccount(e){if(e.identifier==="account-payment"){const t=this.order.getValue().customer;t.account_amount+=e.value,this.selectCustomer(t)}}getPriceWithoutTax(e,t,s){if(s==="inclusive")return E.computeInclusive(e,t);if(s==="exclusive")return e}getPriceWithTax(e,t,s){if(s==="inclusive")return e;if(s==="exclusive")return E.computeExclusive(e,t)}getVatValue(e,t,s){if(s==="inclusive")return e-this.getPriceWithoutTax(e,t,s);if(s==="exclusive")return this.getPriceWithTax(e,t,s)-e}computeTaxes(){return new Promise((e,t)=>{let s=this.order.getValue();if(s=this.computeProductsTaxes(s),s.tax_group_id===void 0||s.tax_group_id===null)return this.computeOrderTaxes(s),e({data:{order:s},status:"success"});const i=s.tax_groups;if(Object.values(i).length>0)return i[s.tax_group_id]!==void 0&&(s=this.computeOrderTaxGroup(s,i[s.tax_group_id])),e({status:"success",data:{tax:i[s.tax_group_id],order:s}});if(s.tax_group_id!==void 0&&s.tax_group_id.toString().length>0)b.get(`/api/taxes/groups/${s.tax_group_id}`).subscribe({next:o=>(s=this.computeOrderTaxGroup(s,o),e({status:"success",data:{tax:o,order:s}})),error:o=>t(o)});else return t({status:"failed",message:u("No tax group assigned to the order")})})}computeOrderTaxGroup(e,t){const s=t.taxes.map(o=>parseFloat(o.rate)).reduce((o,r)=>o+r),i=this.getVatValue(e.subtotal-e.discount,s,e.tax_type);return t.taxes=t.taxes.map(o=>{const r=_(_(o.rate).divide(s).done()).multiply(100).done();return{id:o.id,name:o.name,rate:parseFloat(o.rate),tax_value:_(_(i).multiply(r).done()).divide(100).done()}}),t.taxes.length===0?h.error(u("The selected tax group doesn't have any assigned sub taxes. This might cause wrong figures."),u("Proceed"),{duration:!1}).subscribe():(e.tax_groups=e.tax_groups||[],e.taxes=t.taxes,e.tax_groups[t.id]=t,this.computeOrderTaxes(e))}computeOrderTaxes(e){const t=this.options.getValue().ns_pos_vat,s=this.options.getValue().ns_pos_price_with_tax==="yes";return["flat_vat","variable_vat","products_variable_vat","products_flat_vat"].includes(t)&&e.taxes&&e.taxes.length>0&&(e.tax_value+=e.taxes.map(i=>i.tax_value).reduce((i,o)=>i+o)),e.total_tax_value=e.tax_value,["products_variable_vat","products_flat_vat","products_vat"].includes(t)&&!s&&(e.total_tax_value=e.products_exclusive_tax_value+e.tax_value),e}computeProductsTaxes(e){const t=this.products.getValue(),s=t.filter(r=>r.tax_type==="inclusive").map(r=>r.tax_value),i=t.filter(r=>r.tax_type==="exclusive").map(r=>r.tax_value);e.products_exclusive_tax_value=0,e.products_inclusive_tax_value=0;const o=this.options.getValue().ns_pos_vat;return["products_flat_vat","products_variable_vat","products_vat"].includes(o)&&i.length>0&&(e.products_exclusive_tax_value+=i.reduce((r,n)=>r+n)),["products_flat_vat","products_variable_vat","products_vat"].includes(o)&&s.length>0&&(e.products_inclusive_tax_value+=s.reduce((r,n)=>r+n)),e.products=t,e.total_products=t.length,e}canProceedAsLaidAway(e){return new Promise(async(t,s)=>{const i=e.customer.group.minimal_credit_payment;let o=(e.total*i/100).toFixed(ns.currency.ns_currency_precision);o=parseFloat(o);try{const r=await new Promise((n,c)=>{V.show(ve,{order:e,reject:c,resolve:n})});if(r.order.instalments.length===0&&r.order.tendered<o){const n=u("Before saving this order, a minimum payment of {amount} is required").replace("{amount}",S(o));return V.show(we,{title:u("Unable to proceed"),message:n}),s({status:"failed",message:n})}else{const n=this.selectedPaymentType.getValue(),c=r.order.instalments.filter(a=>a.amount>=o&&N(a.date).isSame(ns.date.moment.startOf("day"),"day"));if(c.length===0)return t({status:"success",message:u("Layaway defined"),data:{order:r.order}});const d=c[0].amount;d>0?V.show(k,{title:u("Initial Payment"),message:u('In order to proceed, an initial payment of {amount} is required for the selected payment type "{paymentType}". Would you like to proceed ?').replace("{amount}",S(d)).replace("{paymentType}",n.label),onAction:a=>{if(a){const w={identifier:n.identifier,label:n.label,value:d,readonly:!1,selected:!0};this.addPayment(w),c[0].paid=!0,t({status:"success",message:u("Layaway defined"),data:{order:r.order}})}else s({status:"failed",message:u("The request was canceled")})}}):t({status:"success",message:u("Layaway defined"),data:{order:r.order}})}}catch(r){return s(r)}})}submitOrder(e={}){return new Promise(async(t,s)=>{var i={...this.order.getValue(),...e};const o=i.customer.group.minimal_credit_payment;if(i.payment_status!=="hold"&&i.payments.length===0&&i.total>0&&i.total>i.tendered){if(this.options.getValue().ns_orders_allow_partial==="no"){const r=u("Partially paid orders are disabled.");return s({status:"failed",message:r})}else if(o>=0)try{i=(await this.canProceedAsLaidAway(i)).data.order}catch(r){return s(r)}}if(!this._isSubmitting){const r=i.id!==void 0?"put":"post";return this._isSubmitting=!0,b[r](`/api/orders${i.id!==void 0?"/"+i.id:""}`,i).subscribe({next:n=>{t(n),this.reset(),m.doAction("ns-order-submit-successful",n),this._isSubmitting=!1;const c=this.options.getValue().ns_pos_complete_sale_audio;c.length>0&&new Audio(c).play()},error:n=>{this._isSubmitting=!1,s(n),m.doAction("ns-order-submit-failed",n)}})}return s({status:"failed",message:u("An order is currently being processed.")})})}defineQuantities(e,t=[]){return new Promise((s,i)=>{const r={unit:t.filter(c=>c.id===e.unit_id)[0]||{},sale_price_with_tax:e.mode==="normal"?parseFloat(e.price_with_tax):0,sale_price_without_tax:e.mode==="normal"?parseFloat(e.price_without_tax):0,sale_price:e.mode==="normal"?parseFloat(e.unit_price):0,sale_price_tax:e.mode==="normal"?e.tax_value:0,sale_price_edit:0,wholesale_price_with_tax:e.mode==="wholesale"?parseFloat(e.price_with_tax):0,wholesale_price_without_tax:e.mode==="wholesale"?parseFloat(e.price_without_tax):0,wholesale_price:e.mode==="wholesale"?parseFloat(e.unit_price):0,wholesale_price_tax:e.mode==="wholesale"?e.tax_value:0,wholesale_price_edit:0,custom_price_with_tax:e.mode==="custom"?parseFloat(e.price_with_tax):0,custom_price_without_tax:e.mode==="custom"?parseFloat(e.price_without_tax):0,custom_price:e.mode==="custom"?parseFloat(e.unit_price):0,custom_price_tax:e.mode==="custom"?e.tax_value:0,custom_price_edit:e.mode==="custom"?parseFloat(e.unit_price):0};let n;if(["inclusive","exclusive"].includes(e.tax_type))try{if(e.tax_group_id)b.get(`/api/taxes/groups/${e.tax_group_id}`).subscribe({next:c=>(["sale","wholesale","custom"].forEach(d=>{r[d+"_price_tax"]=c.taxes.map(a=>this.getVatValue(r[d+"_price"],a.rate,e.tax_type)).reduce((a,w)=>a+w),r["gross_"+d+"_price"]=r[d+"_price"]+r[d+"_price_tax"],r["net_"+d+"_price"]=r[d+"_price"]-r[d+"_price_tax"]}),n=c,s(r)),error:c=>{i(!1)}});else return r.sale_price_tax=0,r.wholesale_price_tax=0,r.sale_price_without_tax=e.unit_price,s(r)}catch{return h.error(u("An error has occurred while computing the product.")).subscribe()}return s(r)})}loadOrder(e){return new Promise((t,s)=>{b.get(`/api/orders/${e}/pos`).subscribe({next:async i=>{try{m.doAction("ns-before-load-order",{order:i})}catch(r){return s(r)}this.options.getValue(),i={...this.defaultOrder(),...i};const o=[];for(let r=0;r<i.products.length;r++){const n=i.products[r];n.product===null&&(n.product={mode:"custom",name:n.name,unit_id:n.unit_id,unit_quantities:[await this.defineQuantities(n)]}),n.$original=()=>n.product,n.$quantities=()=>{let c=n.product.unit_quantities.filter(d=>+d.id==+n.unit_quantity_id||d.id===void 0)[0];return n.mode==="custom"&&(c.custom_price_edit=n.unit_price,c.custom_price_with_tax=n.price_with_tax,c.custom_price_without_tax=n.price_without_tax,c.custom_price_tax=n.tax_value),c},o.push(n)}i.type=Object.values(this.types.getValue()).filter(r=>r.identifier===i.type)[0],i.addresses={shipping:i.shipping_address,billing:i.billing_address},delete i.shipping_address,delete i.billing_address,this.buildOrder(i),this.buildProducts(o),await this.selectCustomer(i.customer),t(i)},error:i=>s(i)})})}buildOrder(e){this.order.next(e)}buildProducts(e){this.recomputeProducts(e),this.products.next(e),m.doAction("ns-after-cart-changed")}printOrderReceipt(e,t){const s=this.options.getValue();if(s.ns_pos_printing_enabled_for==="disabled")return!1;if(s.ns_pos_printing_enabled_for==="all_orders")this.print.process(e.id,"sale",t);else if(s.ns_pos_printing_enabled_for==="partially_paid_orders"&&["paid","partially_paid"].includes(e.payment_status))this.print.process(e.id,"sale",t);else if(s.ns_pos_printing_enabled_for==="only_paid_orders"&&["paid"].includes(e.payment_status))this.print.process(e.id,"sale",t);else return!1}computePaid(){const e=this._order.getValue();e.tendered=0,e.payments.length>0&&(e.tendered=e.payments.map(t=>t.value).reduce((t,s)=>s+t)),e.tendered>=e.total?e.payment_status="paid":e.tendered>0&&e.tendered<e.total&&(e.payment_status="partially_paid"),e.change=e.tendered-e.total,this._order.next(e)}setPaymentActive(e){const t=this._paymentsType.getValue();t.forEach(s=>{s.identifier===e.identifier?s.selected=!0:s.selected=!1}),this._paymentsType.next(t)}definedPaymentsType(e){this._paymentsType.next(e)}selectCustomer(e){return new Promise((t,s)=>{const i=this.order.getValue(),o=Object.assign(e.billing||{},{});if(o.id!==void 0&&delete o.id,i.customer=e,i.customer_id=e.id,i.addresses.billing=o,this.order.next(i),e.group===void 0||e.group===null)b.get(`/api/customers/${e.id}/group`).subscribe({next:r=>{i.customer.group=r,this.order.next(i),t(i)},error:r=>{s(r)}});else return t(i)})}updateCart(e,t){for(let s in t)t[s]!==void 0&&(e[s]=t[s]);this.order.next(e),this.refreshCart()}checkCart(){const e=this.order.getValue(),t=[];e.coupons.forEach(s=>{let i=!0;s.products.length>0&&(i=e.products.filter(r=>s.products.map(n=>n.product_id).includes(r.product_id)).length>0,!i&&t.indexOf(s)===-1&&t.push(s));let o=!0;s.categories.length>0&&(o=e.products.filter(r=>s.categories.map(n=>n.category_id).includes(r.$original().category_id)).length>0,!o&&t.indexOf(s)===-1&&t.push(s))}),t.forEach(s=>{h.error(u(`The coupons "%s" has been removed from the cart, as it's required conditions are no more meet.`).replace("%s",s.name),u("Okay"),{duration:6e3}).subscribe(),this.removeCoupon(s)})}async refreshCart(){this.checkCart();const e=this.products.getValue();let t=this.order.getValue(),s=this.options.getValue().ns_pos_price_with_tax;const i=e.filter(a=>a.product_type!=="dynamic").map(a=>s==="yes"?a.total_price_with_tax:a.total_price_without_tax);if(i.length>0){let a=i.reduce((g,q)=>g+q),w=0,$=e.filter(g=>g.product_type==="dynamic").map(g=>(g.unit_price=a*g.rate/100,g.total_price=g.unit_price*g.quantity,g.total_price));$.length>0&&(w=$.reduce((g,q)=>g+q)),t.subtotal=a+w}else t.subtotal=0;const o=t.coupons.map(a=>a.type==="percentage_discount"?(a.value=t.subtotal*a.discount_value/100,a.value):(a.value=a.discount_value,a.value));t.total_coupons=0,o.length>0&&(t.total_coupons=o.reduce((a,w)=>a+w)),t.discount_type==="percentage"&&(t.discount=t.discount_percentage*t.subtotal/100),t.discount>t.subtotal&&t.total_coupons===0&&(t.discount=t.subtotal,h.info(u("The discount has been set to the cart subtotal.")).subscribe()),t.tax_value=0,t.total_tax_value=0,this.order.next(t);try{t=(await this.computeTaxes()).data.order}catch(a){a!==!1&&a.message!==void 0&&h.error(a.message||u("An unexpected error has occurred while fecthing taxes."),u("OKAY"),{duration:0}).subscribe()}const r=e.map(a=>a.tax_type==="inclusive"?a.tax_value:0);r.length>0&&r.reduce((a,w)=>a+w);const n=t.tax_type,c=this.options.getValue().ns_pos_vat;let d=0;["flat_vat","variable_vat","products_vat","products_flat_vat","products_variable_vat"].includes(c)&&(d=t.total_tax_value),n==="exclusive"?t.total=+(t.subtotal+(t.shipping||0)+d-t.discount-t.total_coupons).toFixed(ns.currency.ns_currency_precision):t.total=+(t.subtotal+(t.shipping||0)-t.discount-t.total_coupons).toFixed(ns.currency.ns_currency_precision),this.order.next(t),m.doAction("ns-cart-after-refreshed",t)}getStockUsage(e,t){const s=this._products.getValue().filter(i=>i.product_id===e&&i.unit_quantity_id===t).map(i=>i.quantity);return s.length>0?s.reduce((i,o)=>i+o):0}async addToCart(e){let t=new Object,s={product_id:e.id||0,name:e.name,discount_type:"percentage",discount:0,discount_percentage:0,product_type:e.product_type||"product",rate:e.rate||0,quantity:e.quantity||0,tax_group_id:e.tax_group_id,tax_type:e.tax_type||void 0,tax_value:0,unit_id:e.unit_id||0,unit_price:e.unit_price||0,price_with_tax:e.price_with_tax||0,price_without_tax:e.price_without_tax||0,unit_name:e.unit_name||"",total_price:0,total_price_without_tax:0,total_price_with_tax:0,mode:e.mode||"normal",$original:e.$original||(()=>e),$quantities:e.$quantities||void 0};if(this._processingAddQueue=!0,s.product_id!==0)for(let r in this.addToCartQueue)try{const c=await new this.addToCartQueue[r](s).run(t);t={...t,...c}}catch(n){if(n===!1)return this._processingAddQueue=!1,!1}this._processingAddQueue=!1,s={...s,...t};const i=this._products.getValue();if(this.settings.getValue().ns_pos_items_merge){const r=i.filter(n=>n.product_id===s.product_id&&n.tax_group_id===s.tax_group_id&&n.unit_id===s.unit_id&&n.unit_quantity_id===s.unit_quantity_id);r.length>0?r[0].quantity+=s.quantity:i.unshift(s)}else i.unshift(s);this.recomputeProducts(i),this.products.next(i);const o=this.options.getValue().ns_pos_new_item_audio;o.length>0&&new Audio(o).play(),m.doAction("ns-after-cart-changed")}defineTypes(e){this._types.next(e)}removeProduct(e){const t=this._products.getValue(),s=t.indexOf(e);t.splice(s,1),this.products.next(t),m.doAction("ns-after-cart-changed")}updateProduct(e,t,s=null){const i=this._products.getValue();s=s===null?i.indexOf(e):s,s=s===-1?0:s,i[s]={...e,...t},this.recomputeProducts(i),this.products.next(i),m.doAction("ns-after-cart-changed")}recomputeProducts(e=null){e.forEach(t=>{this.computeProduct(t)})}getProductUnitPrice(e,t){switch(e){case"custom":return t.custom_price_edit;case"normal":return t.sale_price_edit;case"wholesale":return t.wholesale_price_edit}}computeProductTax(e){switch(e.mode){case"custom":return this.computeCustomProductTax(e);case"normal":return this.computeNormalProductTax(e);case"wholesale":return this.computeWholesaleProductTax(e);default:return e}}proceedProductTaxComputation(e,t){const s=e.$original(),i=s.tax_group;let o=this.getProductUnitPrice(e.mode,e.$quantities()),r=0,n=this.getProductUnitPrice(e.mode,e.$quantities());if(i!=null&&i.taxes!==void 0){let c=0;switch(i.taxes.length>0&&(c=i.taxes.map(d=>d.rate).reduce((d,a)=>d+a)),s.tax_type){case"inclusive":o=this.getPriceWithoutTax(t,c,s.tax_type),n=t;break;case"exclusive":o=t,n=this.getPriceWithTax(t,c,s.tax_type);break}r=this.getVatValue(t,c,s.tax_type)}return{price_without_tax:o,tax_value:r,price_with_tax:n}}computeCustomProductTax(e){e.$original();const t=e.$quantities(),s=this.proceedProductTaxComputation(e,t.custom_price_edit);return t.custom_price_without_tax=s.price_without_tax,t.custom_price_with_tax=s.price_with_tax,t.custom_price_tax=s.tax_value,e.$quantities=()=>t,e}computeNormalProductTax(e){const t=e.$quantities(),s=this.proceedProductTaxComputation(e,t.sale_price_edit);return t.sale_price_without_tax=s.price_without_tax,t.sale_price_with_tax=s.price_with_tax,t.sale_price_tax=s.tax_value,e.$quantities=()=>t,e}computeWholesaleProductTax(e){const t=e.$quantities(),s=this.proceedProductTaxComputation(e,t.wholesale_price_edit);return t.wholesale_price_without_tax=s.price_without_tax,t.wholesale_price_with_tax=s.price_with_tax,t.wholesale_price_tax=s.tax_value,e.$quantities=()=>t,e}getPrice(e,t,s){switch(t){case"normal":return e["sale_price_"+s];case"wholesale":return e["wholesale_price_"+s];case"custom":return e["custom_price_"+s]}}computeProduct(e){e.product_type==="product"&&(e.mode==="normal"?(e.unit_price=this.getSalePrice(e.$quantities(),e.$original()),e.tax_value=_(e.$quantities().sale_price_tax).multiply(e.quantity).done()):e.mode==="wholesale"&&(e.unit_price=this.getWholesalePrice(e.$quantities(),e.$original()),e.tax_value=_(e.$quantities().wholesale_price_tax).multiply(e.quantity).done()),e.mode==="custom"&&(e.unit_price=this.getCustomPrice(e.$quantities(),e.$original()),e.tax_value=_(e.$quantities().custom_price_tax).multiply(e.quantity).done()));let t=0,s=0,i=this.getPrice(e.$quantities(),e.mode,"with_tax"),o=this.getPrice(e.$quantities(),e.mode,"without_tax");["flat","percentage"].includes(e.discount_type)&&(e.discount_type==="percentage"?(e.discount=_(_(_(e.unit_price).multiply(e.discount_percentage).done()).divide(100).done()).multiply(e.quantity).done(),t=_(_(_(o).multiply(e.discount_percentage).done()).divide(100).done()).multiply(e.quantity).done(),s=_(_(_(i).multiply(e.discount_percentage).done()).divide(100).done()).multiply(e.quantity).done()):(t=e.discount,s=e.discount)),e.price_with_tax=i,e.price_without_tax=o,e.total_price=_(_(e.unit_price).multiply(e.quantity).done()).subtract(e.discount).done(),e.total_price_with_tax=_(_(i).multiply(e.quantity).done()).subtract(s).done(),e.total_price_without_tax=_(_(o).multiply(e.quantity).done()).subtract(t).done(),m.doAction("ns-after-product-computed",e)}loadCustomer(e){return b.get(`/api/customers/${e}`)}defineSettings(e){this._settings.next(e)}voidOrder(e){e.id!==void 0?["hold"].includes(e.payment_status)?V.show(k,{title:u("Order Deletion"),message:u("The current order will be deleted as no payment has been made so far."),onAction:t=>{t&&b.delete(`/api/orders/${e.id}`).subscribe({next:s=>{h.success(s.message).subscribe(),this.reset()},error:s=>h.error(s.message).subscribe()})}}):V.show(be,{title:u("Void The Order"),message:u("The current order will be void. This will cancel the transaction, but the order won't be deleted. Further details about the operation will be tracked on the report. Consider providing the reason of this operation."),onAction:t=>{t!==!1&&b.post(`/api/orders/${e.id}/void`,{reason:t}).subscribe({next:s=>{h.success(s.message).subscribe(),this.reset()},error:s=>h.error(s.message).subscribe()})}}):h.error(u("Unable to void an unpaid order.")).subscribe()}async triggerOrderTypeSelection(e){for(let t=0;t<this.orderTypeQueue.length;t++)await this.orderTypeQueue[t].promise(e)}set(e,t){const s=this.settings.getValue();s[e]=t,this.settings.next(s)}unset(e){const t=this.settings.getValue();delete t[e],this.settings.next(t)}get(e){return this.settings.getValue()[e]}destroy(){this._products.unsubscribe(),this._customers.unsubscribe(),this._types.unsubscribe(),this._breadcrumbs.unsubscribe(),this._paymentsType.unsubscribe(),this._screen.unsubscribe(),this._order.unsubscribe(),this._settings.unsubscribe()}};window.POS=new I;window.POSClass=I;
