import{_ as g,A as T,B as P,K as f,q as m,C as v,o as l,f as n,g as s,t as d,D as x,x as S,y as C,bz as I,F as p,v as b,j as c,l as y,H as w}from"./bootstrap.2e9dca7e.js";import{s as j}from"./pos-section-switch.b95dab59.js";import{_ as k}from"./plugin-vue_export-helper.21dcd24c.js";import{n as O}from"./currency.c7faaf91.js";const V={name:"ns-pos-search-product",data(){return{searchValue:"",products:[],isLoading:!1,debounce:null}},watch:{searchValue(){clearTimeout(this.debounce),this.debounce=setTimeout(()=>{this.search()},500)}},mounted(){this.$refs.searchField.focus(),this.$refs.searchField.addEventListener("keydown",t=>{t.keyCode===27&&this.popupResolver(!1)}),this.popupCloser()},methods:{__:g,popupCloser:T,popupResolver:P,addToCart(t){POS.addToCart(t),this.$popup.close()},search(){this.isLoading=!0,f.post("/api/nexopos/v4/products/search",{search:this.searchValue}).subscribe({next:t=>{this.isLoading=!1,this.products=t,this.products.length===1&&this.addToCart(this.products[0])},error:t=>{this.isLoading=!1,m.error(t.message).subscribe()}})}}},H={id:"product-search",class:"ns-box shadow-lg w-95vw h-95vh md:h-3/5-screen md:w-2/4-screen flex flex-col overflow-hidden"},L={class:"p-2 border-b ns-box-header flex justify-between items-center"},W={class:"text-primary"},B={class:"flex-auto overflow-hidden flex flex-col"},q={class:"p-2 border-b ns-box-body"},F={class:"flex input-group info border-2 rounded overflow-hidden"},z={class:"overflow-y-auto ns-scrollbar flex-auto relative"},N={class:"ns-vertical-menu"},U=["onClick"],A={class:"text-primary"},D=s("div",null,null,-1),E={key:0},M={class:"text-primary text-center p-2"},$={key:1,class:"absolute h-full w-full flex items-center justify-center z-10 top-0",style:{background:"rgb(187 203 214 / 29%)"}};function G(t,e,u,_,o,r){const i=v("ns-close-button"),a=v("ns-spinner");return l(),n("div",H,[s("div",L,[s("h3",W,d(r.__("Search Product")),1),s("div",null,[x(i,{onClick:e[0]||(e[0]=h=>t.$popup.close())})])]),s("div",B,[s("div",q,[s("div",F,[S(s("input",{onKeyup:e[1]||(e[1]=I(h=>r.search(),["enter"])),"onUpdate:modelValue":e[2]||(e[2]=h=>o.searchValue=h),ref:"searchField",type:"text",class:"p-2 outline-none flex-auto text-primary"},null,544),[[C,o.searchValue]]),s("button",{onClick:e[3]||(e[3]=h=>r.search()),class:"px-2"},d(r.__("Search")),1)])]),s("div",z,[s("ul",N,[(l(!0),n(p,null,b(o.products,h=>(l(),n("li",{key:h.id,onClick:Ne=>r.addToCart(h),class:"cursor-pointer p-2 flex justify-between border-b"},[s("div",A,d(h.name),1),D],8,U))),128))]),o.products.length===0?(l(),n("ul",E,[s("li",M,d(r.__("There is nothing to display. Have you started the search ?")),1)])):c("",!0),o.isLoading?(l(),n("div",$,[x(a)])):c("",!0)])])])}var K=k(V,[["render",G]]);const R={name:"ns-pos-grid",data(){return{items:Array.from({length:1e3},(t,e)=>({data:"#"+e})),products:[],categories:[],breadcrumbs:[],barcode:"",previousCategory:null,order:null,visibleSection:null,breadcrumbsSubsribe:null,orderSubscription:null,visibleSectionSubscriber:null,currentCategory:null,settings:{},settingsSubscriber:null,options:!1,optionsSubscriber:null,interval:null,searchTimeout:null,gridItemsWidth:0,gridItemsHeight:0,isLoading:!1}},computed:{hasCategories(){return this.categories.length>0}},watch:{options:{handler(){this.options.ns_pos_force_autofocus&&(clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.submitSearch(this.barcode)},200))},deep:!0},barcode(){this.options.ns_pos_force_autofocus&&(clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.submitSearch(this.barcode)},200))}},mounted(){this.loadCategories(),this.settingsSubscriber=POS.settings.subscribe(t=>{this.settings=t,this.$forceUpdate()}),this.optionsSubscriber=POS.options.subscribe(t=>{this.options=t,this.$forceUpdate()}),this.breadcrumbsSubsribe=POS.breadcrumbs.subscribe(t=>{this.breadcrumbs=t,this.$forceUpdate()}),this.visibleSectionSubscriber=POS.visibleSection.subscribe(t=>{this.visibleSection=t,this.$forceUpdate()}),this.orderSubscription=POS.order.subscribe(t=>this.order=t),this.interval=setInterval(()=>this.checkFocus(),500);for(let t in nsShortcuts)["ns_pos_keyboard_quick_search"].includes(t)&&nsHotPress.create("search-popup").whenNotVisible([".is-popup","#product-search"]).whenPressed(nsShortcuts[t],e=>{e.preventDefault(),this.openSearchPopup()}),["ns_pos_keyboard_toggle_merge"].includes(t)&&nsHotPress.create("toggle-merge").whenNotVisible([".is-popup"]).whenPressed(nsShortcuts[t],e=>{e.preventDefault(),this.posToggleMerge()})},destroyed(){this.orderSubscription.unsubscribe(),this.breadcrumbsSubsribe.unsubscribe(),this.visibleSectionSubscriber.unsubscribe(),this.screenSubscriber.unsubscribe(),this.settingsSubscriber.unsubscribe(),this.optionsSubscriber.unsubscribe(),clearInterval(this.interval),nsHotPress.destroy("search-popup"),nsHotPress.destroy("toggle-merge")},methods:{__:g,nsCurrency:O,switchTo:j,posToggleMerge(){POS.set("ns_pos_items_merge",!this.settings.ns_pos_items_merge)},computeGridWidth(){document.getElementById("grid-items")!==null&&(this.gridItemsWidth=document.getElementById("grid-items").offsetWidth,this.gridItemsHeight=document.getElementById("grid-items").offsetHeight)},cellSizeAndPositionGetter(t,e){const u={xs:{width:this.gridItemsWidth/2,items:2,height:200},sm:{width:this.gridItemsWidth/2,items:2,height:200},md:{width:this.gridItemsWidth/3,items:3,height:150},lg:{width:this.gridItemsWidth/4,items:4,height:150},xl:{width:this.gridItemsWidth/6,items:6,height:150}},_=u[POS.responsive.screenIs].width,o=u[POS.responsive.screenIs].height,r=0;return{width:_-r,height:o,x:e%u[POS.responsive.screenIs].items*_-r,y:parseInt(e/u[POS.responsive.screenIs].items)*o}},openSearchPopup(){Popup.show(K)},submitSearch(t){t.length>0&&f.get(`/api/nexopos/v4/products/search/using-barcode/${t}`).subscribe({next:e=>{this.barcode="",POS.addToCart(e.product)},error:e=>{this.barcode="",m.error(e.message).subscribe()}})},checkFocus(){this.options.ns_pos_force_autofocus&&document.querySelectorAll(".is-popup").length===0&&this.$refs.search.focus()},loadCategories(t){this.isLoading=!0,f.get(`/api/nexopos/v4/categories/pos/${t?t.id:""}`).subscribe({next:e=>{this.categories=e.categories,this.products=e.products,this.previousCategory=e.previousCategory,this.currentCategory=e.currentCategory,this.updateBreadCrumb(this.currentCategory),this.isLoading=!1},error:e=>(this.isLoading=!1,m.error(g("An unexpected error occured.")).subscribe())})},updateBreadCrumb(t){if(t){const e=this.breadcrumb.filter(u=>u.id===t.id);if(e.length>0){let u=!0;const _=this.breadcrumb.filter(o=>o.id===e[0].id&&u?(u=!1,!0):u);this.breadcrumb=_}else this.breadcrumb.push(t)}else this.breadcrumb=[];POS.breadcrumbs.next(this.breadcrumb)},addToTheCart(t){POS.addToCart(t)}}},J={id:"pos-grid",class:"flex-auto flex flex-col"},Q={key:0,id:"tools",class:"flex pl-2"},X={key:0,class:"products-count flex items-center justify-center text-sm rounded-full h-6 w-6 ml-1"},Y={id:"grid-container",class:"rounded shadow overflow-hidden flex-auto flex flex-col"},Z={id:"grid-header",class:"p-2 border-b"},ee={class:"border rounded flex overflow-hidden"},se=["title"],te=s("i",{class:"las la-search"},null,-1),ie=[te],re=["title"],oe=s("i",{class:"las la-compress-arrows-alt"},null,-1),le=[oe],ne=["title"],ce=s("i",{class:"las la-barcode"},null,-1),de=[ce],ue={style:{height:"0px"}},ae={key:0,class:"fade-in-entrance ns-loader"},he=s("div",{class:"bar"},null,-1),_e=[he],pe={id:"grid-breadscrumb",class:"p-2"},be={class:"flex"},ge=s("i",{class:"las la-angle-right"},null,-1),fe=["onClick"],me=s("i",{class:"las la-angle-right"},null,-1),ve={id:"grid-items",class:"overflow-hidden h-full flex-col flex"},xe={key:0,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},ye=["onClick"],we={class:"h-full w-full flex items-center justify-center"},Se=["src","alt"],Ce={key:1,class:"las la-image text-6xl"},ke={class:"w-full absolute z-10 -bottom-10"},Te={class:"cell-item-label relative w-full flex items-center justify-center -top-10 h-20 py-2"},Pe={class:"text-sm font-bold py-2 text-center"},Ie={key:1,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},je=["onClick"],Oe={class:"h-full w-full flex items-center justify-center overflow-hidden"},Ve=["src","alt"],He={key:1,class:"las la-image text-6xl"},Le={class:"w-full absolute z-10 -bottom-10"},We={class:"cell-item-label relative w-full flex flex-col items-center justify-center -top-10 h-20 p-2"},Be={class:"text-sm text-center w-full"},qe={key:0,class:"text-sm"},Fe={key:0,class:"text-sm"};function ze(t,e,u,_,o,r){return l(),n("div",J,[o.visibleSection==="grid"?(l(),n("div",Q,[s("div",{onClick:e[0]||(e[0]=i=>r.switchTo("cart")),class:"switch-cart flex cursor-pointer rounded-tl-lg rounded-tr-lg px-3 py-2 border-t border-r border-l"},[s("span",null,d(r.__("Cart")),1),o.order?(l(),n("span",X,d(o.order.products.length),1)):c("",!0)]),s("div",{onClick:e[1]||(e[1]=i=>r.switchTo("grid")),class:"switch-grid cursor-pointer rounded-tl-lg rounded-tr-lg px-3 py-2 font-semibold"},d(r.__("Products")),1)])):c("",!0),s("div",Y,[s("div",Z,[s("div",ee,[s("button",{title:r.__("Search for products."),onClick:e[2]||(e[2]=i=>r.openSearchPopup()),class:"w-10 h-10 border-r outline-none"},ie,8,se),s("button",{title:r.__("Toggle merging similar products."),onClick:e[3]||(e[3]=i=>r.posToggleMerge()),class:y([o.settings.ns_pos_items_merge?"pos-button-clicked":"","outline-none w-10 h-10 border-r"])},le,10,re),s("button",{title:r.__("Toggle auto focus."),onClick:e[4]||(e[4]=i=>o.options.ns_pos_force_autofocus=!o.options.ns_pos_force_autofocus),class:y([o.options.ns_pos_force_autofocus?"pos-button-clicked":"","outline-none w-10 h-10 border-r"])},de,10,ne),S(s("input",{ref:"search","onUpdate:modelValue":e[5]||(e[5]=i=>o.barcode=i),type:"text",class:"flex-auto outline-none px-2"},null,512),[[C,o.barcode]])])]),s("div",ue,[o.isLoading?(l(),n("div",ae,_e)):c("",!0)]),s("div",pe,[s("ul",be,[s("li",null,[s("a",{onClick:e[6]||(e[6]=i=>r.loadCategories()),href:"javascript:void(0)",class:"px-3"},d(r.__("Home")),1),w(),ge]),s("li",null,[(l(!0),n(p,null,b(o.breadcrumbs,i=>(l(),n("a",{onClick:a=>r.loadCategories(i),key:i.id,href:"javascript:void(0)",class:"px-3"},[w(d(i.name)+" ",1),me],8,fe))),128))])])]),s("div",ve,[r.hasCategories?(l(),n("div",xe,[(l(!0),n(p,null,b(o.categories,i=>(l(),n("div",{onClick:a=>r.loadCategories(i),key:i.id,class:"cell-item w-full h-36 cursor-pointer border flex flex-col items-center justify-center overflow-hidden relative"},[s("div",we,[i.preview_url?(l(),n("img",{key:0,src:i.preview_url,class:"object-cover h-full",alt:i.name},null,8,Se)):c("",!0),i.preview_url?c("",!0):(l(),n("i",Ce))]),s("div",ke,[s("div",Te,[s("h3",Pe,d(i.name),1)])])],8,ye))),128))])):c("",!0),r.hasCategories?c("",!0):(l(),n("div",Ie,[(l(!0),n(p,null,b(o.products,i=>(l(),n("div",{onClick:a=>r.addToTheCart(i),key:i.id,class:"cell-item w-full h-36 cursor-pointer border flex flex-col items-center justify-center overflow-hidden relative"},[s("div",Oe,[i.galleries&&i.galleries.filter(a=>a.featured===1).length>0?(l(),n("img",{key:0,src:i.galleries.filter(a=>a.featured===1)[0].url,class:"object-cover h-full",alt:i.name},null,8,Ve)):c("",!0),!i.galleries||i.galleries.filter(a=>a.featured===1).length===0?(l(),n("i",He)):c("",!0)]),s("div",Le,[s("div",We,[s("h3",Be,d(i.name),1),o.options.ns_pos_gross_price_used==="yes"?(l(),n(p,{key:0},[i.unit_quantities&&i.unit_quantities.length===1?(l(),n("span",qe,d(r.nsCurrency(i.unit_quantities[0].sale_price_without_tax)),1)):c("",!0)],64)):c("",!0),o.options.ns_pos_gross_price_used==="no"?(l(),n(p,{key:1},[i.unit_quantities&&i.unit_quantities.length===1?(l(),n("span",Fe,d(r.nsCurrency(i.unit_quantities[0].sale_price_with_tax)),1)):c("",!0)],64)):c("",!0)])])],8,je))),128))]))])])])}var Me=k(R,[["render",ze]]);export{Me as default};
