import{_ as u}from"./lang.2d0006f0.js";import{F,b as h,n as d,c}from"./bootstrap.b057e509.js";import{f as w}from"./components.f0f947b8.js";import{s as C,b1 as r,aB as o,aC as l,M as v,b6 as p,aA as m,az as S,ba as A,z as _,br as B,b8 as g,am as D,ap as b,b7 as V,aG as E}from"./runtime-core.esm-bundler.db039fbe.js";import{_ as N}from"./plugin-vue_export-helper.21dcd24c.js";import"./runtime-dom.esm-bundler.febf7d20.js";import"./ns-alert-popup.e868772c.js";import"./ns-avatar-image.af6b1173.js";import"./index.es.f7e98ba1.js";import"./vue-upload-component.18541017.js";import"./vue.runtime.esm-bundler.0868408f.js";import"./ns-pos-confirm-popup.de8db6c8.js";import"./ns-notice.a87a26d0.js";import"./ns-media.ba066cb1.js";import"./ns-numpad.41a8e015.js";import"./ns-numpad-plus.49bec1a6.js";import"./ns-pos-loading-popup.48fb88a5.js";import"./ns-paginate.67ffd687.js";import"./ns-prompt-popup.14ac5ecc.js";const T={name:"ns-settings",props:["url"],components:{nsField:w},data(){return{validation:new F,form:{},test:""}},computed:{formDefined(){return Object.values(this.form).length>0},activeTab(){for(let e in this.form.tabs)if(this.form.tabs[e].active===!0)return this.form.tabs[e]}},mounted(){const e=window.location.href,t=new URL(e);this.loadSettingsForm(t.searchParams.get("tab")||null)},methods:{__:u,loadComponent(e){return C(nsExtraComponents[e])},submitForm(){if(this.validation.validateForm(this.form).length===0){this.validation.disableForm(this.form);const e=this.validation.extractForm(this.form);return h.post(this.url,e).subscribe({next:t=>{this.validation.enableForm(this.form),this.loadSettingsForm(),t.data&&t.data.results&&t.data.results.forEach(n=>{n.status==="failed"?d.error(n.message).subscribe():d.success(n.message).subscribe()}),c.doAction("ns-settings-saved",{result:t,instance:this}),d.success(t.message).subscribe()},error:t=>{this.validation.enableForm(this.form),this.validation.triggerFieldsErrors(this.form,t),c.doAction("ns-settings-failed",{error:t,instance:this}),d.error(t.message||u("Unable to proceed the form is not valid.")).subscribe()}})}d.error(this.$slots["error-form-invalid"][0].text||u("Unable to proceed the form is not valid.")).subscribe()},setActive(e){for(let t in this.form.tabs)this.form.tabs[t].active=!1;e.active=!0,c.doAction("ns-settings-change-tab",{tab:e,instance:this})},loadSettingsForm(e=null){h.get(this.url).subscribe(t=>{let n=0;e=t.tabs[e]!==void 0?e:null;for(let i in t.tabs)this.formDefined?t.tabs[i].active=this.form.tabs[i].active:(t.tabs[i].active=!1,(e===null&&n===0||e!==null&&i===e)&&(t.tabs[i].active=!0)),n++,t.tabs[i].fields===void 0&&(t.tabs[i].fields=[]);this.form=this.validation.createForm(t),c.doAction("ns-settings-loaded",this),c.doAction("ns-settings-change-tab",{tab:this.activeTab,instance:this})})}}},j={key:0,id:"tabbed-card",class:"ns-tab"},z={id:"card-header",class:"flex flex-wrap ml-4"},U=["onClick"],H={key:0,class:"ml-2 rounded-full ns-inset-button error active text-sm h-6 w-6 flex items-center justify-center"},L={class:"card-body ns-tab-item"},R={class:"shadow rounded"},G={class:"-mx-4 flex flex-wrap p-2"},M={class:"flex flex-col my-2"},O={key:1,class:"w-full px-4"},P={key:0,class:"border-t border-gray-400 dark:border-slate-600 p-2 flex justify-end"};function q(e,t,n,i,x,s){const k=g("ns-field"),y=g("ns-button");return s.formDefined?(r(),o("div",j,[l("div",z,[(r(!0),o(v,null,p(x.form.tabs,(a,f)=>(r(),o("div",{class:D([a.active?"active":"inactive","tab cursor-pointer flex items-center px-4 py-2 rounded-tl-lg rounded-tr-lg"]),onClick:I=>s.setActive(a),key:f},[l("span",null,b(a.label),1),a.errors&&a.errors.length>0?(r(),o("span",H,b(a.errors.length),1)):m("",!0)],10,U))),128))]),l("div",L,[l("div",R,[l("div",G,[s.activeTab.fields?(r(!0),o(v,{key:0},p(s.activeTab.fields,(a,f)=>(r(),o("div",{class:"w-full px-4 md:w-1/2 lg:w-1/3",key:f},[l("div",M,[_(k,{field:a},null,8,["field"])])]))),128)):m("",!0),s.activeTab.component?(r(),o("div",O,[(r(),S(A(s.loadComponent(s.activeTab.component).value)))])):m("",!0)]),s.activeTab.fields&&s.activeTab.fields.length>0?(r(),o("div",P,[_(y,{onClick:t[0]||(t[0]=a=>s.submitForm()),type:"info"},{default:B(()=>[V(e.$slots,"submit-button",{},()=>[E(b(s.__("Save Settings")),1)])]),_:3})])):m("",!0)])])])):m("",!0)}var mt=N(T,[["render",q]]);export{mt as default};
