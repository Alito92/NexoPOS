import{_ as f,B as P,A as S,o as r,f as i,g as c,t as y,F as u,v as g,l as N,z as V,D as C,j as p,G as h,C as _,E as m,H as w}from"./bootstrap.2e9dca7e.js";import{_ as k}from"./plugin-vue_export-helper.21dcd24c.js";import"./ns-notice.45b2e848.js";import j from"./ns-pos-confirm-popup.bac34743.js";import{n as T}from"./currency.c7faaf91.js";const A={name:"ns-expense-selector",data(){return{configurations:[],type:null}},mounted(){this.configurations=this.$popupParams.configurations,this.type=this.$popupParams.type},methods:{__:f,nsCurrency:T,popupResolver:P,popupCloser:S,selectType(e){this.popupResolver(e)}}},B={class:"w-6/7-screen md:w-4/7-screen lg:w-3/7-screen flex flex-col shadow-lg ns-box"},F={class:"ns-box-header p-2 border-b flex justify-between items-center"},R={class:"font-bold text-xl"},O={class:"grid grid-cols-2"},$=["onClick"],W=["src","alt"],z={class:"font-bold"};function D(e,s,t,x,n,l){return r(),i("div",B,[c("div",F,[c("h3",R,y(l.__("Expense Type")),1)]),c("div",O,[(r(!0),i(u,null,g(n.configurations,o=>(r(),i("div",{class:N([n.type===o.identifier?"info":"","h-40 elevation-surface hoverable flex-col flex items-center justify-center cursor-pointer"]),onClick:b=>l.selectType(o),key:o.identifier},[c("img",{src:o.icon,class:"w-20 my-2",alt:o.label},null,8,W),c("h3",z,y(o.label),1)],10,$))),128))])])}var H=k(A,[["render",D]]);const J={props:["expense"],data(){return{handledExpense:{type:void 0},configurations:[],activeTab:"create-customers",selectedConfiguration:{},isLoading:!1,tabs:[],originalRecurrence:[],validation:new V,recurrence:[]}},computed:{},mounted(){this.init()},watch:{},methods:{__:f,nsCurrency:T,updateSelectLabel(){this.recurrence.length>0&&(this.recurrence[0].options=this.recurrence[0].options.map((e,s)=>{const t=this.originalRecurrence[0].options[s];return["x_days_after_month_starts","x_days_before_month_ends"].includes(e.value)?(e.label=t.label.replace("{day}",this.recurrence[1].value>=0&&this.recurrence[1].value<=1?`${this.recurrence[1].value} day`:`${this.recurrence[1].value} days`),e.label=t.label.replace("{day}",this.recurrence[1].value>=0&&this.recurrence[1].value<=1?`${this.recurrence[1].value} day`:`${this.recurrence[1].value} days`)):["on_specific_day"].includes(e.value)&&(e.label=t.label.replace("{day}",this.ordinalSuffix(this.recurrence[1].value))),e}))},setActiveTab(e){this.activeTab=e},executeCondition(e,s){if(e.shows){const t=s.filter(n=>Object.keys(e.shows).includes(n.name));return t.filter(n=>e.shows[n.name].includes(n.value)).length===t.length}return!0},setTabs(){const e=[{label:this.selectedConfiguration.label||f("N/A"),identifier:"general",active:!0,fields:this.selectedConfiguration.fields}];["ns.recurring-expenses","ns.salary-expenses"].includes(this.selectedConfiguration.identifier)&&e.push({label:f("Recurrence"),identifier:"recurrence"}),this.tabs=e},async init(){try{this.handledExpense={type:void 0},this.isLoading=!0;const{configurations:e,recurrence:s}=await this.loadConfiguration();this.configurations=e,this.recurrence=s,this.originalRecurrence=JSON.parse(JSON.stringify(s)),this.expense!==void 0&&(this.handledExpense=this.expense),this.handledExpense.type===void 0&&await this.selectExpenseType(),this.isLoading=!1,this.setTabs()}catch{}},async selectExpenseType(){try{const e=await new Promise((s,t)=>{Popup.show(H,{resolve:s,reject:t,configurations:this.configurations,type:this.handledExpense.type})});e.fields=this.validation.createFields(e.fields),this.selectedConfiguration=e}catch(e){console.log(e)}},confirmTypeChange(){Popup.show(j,{title:f("Change Type"),message:f("By proceeding the current for and all your entries will be cleared. Would you like to proceed?"),onAction:e=>{e&&this.init()}})},ordinalSuffix(e){var s=e%10,t=e%100;return s==1&&t!=11?e+"st":s==2&&t!=12?e+"nd":s==3&&t!=13?e+"rd":e+"th"},loadConfiguration(){return new Promise((e,s)=>{nsHttpClient.get("/api/nexopos/v4/expenses/configurations").subscribe({next:t=>{e(t)},error:t=>{s(t)}})})}}},G={key:0,class:"h-half w-full flex items-center justify-center"},U={key:1},q={class:"ns-button"},I=c("br",null,null,-1);function K(e,s,t,x,n,l){const o=_("ns-spinner"),b=_("ns-notice"),v=_("ns-field"),E=_("ns-tabs-item"),L=_("ns-tabs");return r(),i(u,null,[n.isLoading?(r(),i("div",G,[C(o)])):p("",!0),n.tabs.length>0&&!n.isLoading?(r(),i("div",U,[C(L,{active:n.activeTab,onActive:s[2]||(s[2]=a=>l.setActiveTab(a))},{extra:h(()=>[c("div",q,[c("button",{onClick:s[0]||(s[0]=a=>l.confirmTypeChange()),class:"py-1 px-2 text-sm rounded"},y(l.__("Change Type")),1)])]),default:h(()=>[(r(!0),i(u,null,g(n.tabs,a=>(r(),m(E,{key:a.identifier,identifier:a.identifier,label:a.label},{default:h(()=>[a.fields?(r(),i(u,{key:0},[n.selectedConfiguration.identifier==="ns.salary-expenses"?(r(),m(b,{key:0,class:"mb-2",color:"info"},{title:h(()=>[w(y(l.__("Warning")),1)]),description:h(()=>[w(y(l.__("While selecting salary expense, the amount defined will be multiplied by the total user assigned to the User group selected.")),1)]),_:1})):p("",!0),I,(r(!0),i(u,null,g(a.fields,d=>(r(),m(v,{key:d.name,field:d},null,8,["field"]))),128))],64)):p("",!0),a.identifier==="recurrence"?(r(!0),i(u,{key:1},g(n.recurrence,d=>(r(),i(u,{key:d.name},[l.executeCondition(d,n.recurrence)?(r(),m(v,{key:0,onChange:s[1]||(s[1]=M=>l.updateSelectLabel()),field:d},null,8,["field"])):p("",!0)],64))),128)):p("",!0)]),_:2},1032,["identifier","label"]))),128))]),_:1},8,["active"])])):p("",!0)],64)}var se=k(J,[["render",K]]);export{se as default};
