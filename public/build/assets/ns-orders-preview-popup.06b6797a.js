import{s as F,_ as c,A as D,p as m,m as v,j as h,o as l,a,f as e,t as i,q as y,F as x,r as w,i as P,e as p,w as k,h as V,B as T,P as j,k as A,l as Y,n as E,x as N,bG as H}from"./bootstrap.3799f74e.js";import{n as R}from"./currency.0f2c1fcb.js";import{_ as O}from"./plugin-vue_export-helper.21dcd24c.js";import{n as q}from"./ns-numpad-plus.1f0a961b.js";import{n as M}from"./ns-select-popup.da8f1f5e.js";import S from"./ns-pos-confirm-popup.0abd3859.js";import{b as z}from"./ns-notice.c1143990.js";import J from"./ns-prompt-popup.b15aee60.js";const K={mounted(){this.popuCloser(),this.loadFields(),this.product=this.$popupParams.product},data(){return{formValidation:new F,fields:[],product:null}},methods:{__:c,popuCloser:D,close(){this.$popupParams.reject(!1),this.$popup.close()},addProduct(){if(this.formValidation.validateFields(this.fields),this.formValidation.fieldsValid(this.fields)){const s=this.formValidation.extractFields(this.fields),t={...this.product,...s};return this.$popupParams.resolve(t),console.log(s,t),this.close()}m.error(c("The form is not valid.")).subscribe()},loadFields(){v.get("/api/nexopos/v4/fields/ns.refund-product").subscribe(s=>{this.fields=this.formValidation.createFields(s),this.fields.forEach(t=>{t.value=this.product[t.name]||""})})}}},X={class:"shadow-xl ns-box w-95vw md:w-3/5-screen lg:w-3/7-screen h-95vh md:h-3/5-screen lg:h-3/7-screen overflow-hidden flex flex-col"},Z={class:"p-2 flex justify-between border-b ns-box-header items-center"},ee={class:"text-semibold"},se={class:"flex-auto overflow-y-auto relative ns-scrollbar"},te={class:"p-2"},ne={key:0,class:"h-full w-full flex items-center justify-center"},re={class:"p-2 flex justify-between items-center border-t ns-box-body"},ie=e("div",null,null,-1);function oe(s,t,r,_,d,n){const b=h("ns-close-button"),o=h("ns-field"),u=h("ns-spinner"),g=h("ns-button");return l(),a("div",X,[e("div",Z,[e("h3",ee,i(n.__("Products")),1),e("div",null,[y(b,{onClick:t[0]||(t[0]=f=>n.close())})])]),e("div",se,[e("div",te,[(l(!0),a(x,null,w(d.fields,(f,C)=>(l(),P(o,{key:C,field:f},null,8,["field"]))),128))]),d.fields.length===0?(l(),a("div",ne,[y(u)])):p("",!0)]),e("div",re,[ie,e("div",null,[y(g,{onClick:t[1]||(t[1]=f=>n.addProduct()),type:"info"},{default:k(()=>[V(i(n.__("Add Product")),1)]),_:1})])])])}var B=O(K,[["render",oe]]);const le={components:{nsNumpad:q},data(){return{product:null,seeValue:0,availableQuantity:0}},mounted(){this.product=this.$popupParams.product,this.availableQuantity=this.$popupParams.availableQuantity,this.seeValue=this.product.quantity},methods:{__:c,popupResolver:T,close(){this.$popupParams.reject(!1),this.$popup.close()},setChangedValue(s){this.seeValue=s},updateQuantity(s){if(s>this.availableQuantity)return m.error("Unable to proceed as the quantity provided is exceed the available quantity.").subscribe();this.product.quantity=parseFloat(s),this.$popupParams.resolve(this.product),this.$popup.close()}}},de={class:"shadow-xl ns-box overflow-hidden w-95vw md:w-4/6-screen lg:w-3/7-screen"},ae={class:"p-2 flex justify-between ns-box-header"},ce={class:"font-semibold"},ue={key:0,class:"border-t border-b ns-box-body py-2 flex items-center justify-center text-2xl font-semibold"},_e={class:"text-primary text-sm"},pe={key:1,class:"flex-auto overflow-y-auto p-2"};function me(s,t,r,_,d,n){const b=h("ns-close-button"),o=h("ns-numpad");return l(),a("div",de,[e("div",ae,[e("h3",ce,i(n.__("Quantity")),1),e("div",null,[y(b,{onClick:t[0]||(t[0]=u=>n.close())})])]),d.product?(l(),a("div",ue,[e("span",null,i(d.seeValue),1),e("span",_e,"("+i(d.availableQuantity)+" "+i(n.__("available"))+")",1)])):p("",!0),d.product?(l(),a("div",pe,[y(o,{value:d.product.quantity,onNext:t[1]||(t[1]=u=>n.updateQuantity(u)),onChanged:t[2]||(t[2]=u=>n.setChangedValue(u))},null,8,["value"])])):p("",!0)])}var fe=O(le,[["render",me]]);class U{constructor({settings:t,options:r,type:_}){this.printingURL={refund:"refund_printing_url",sale:"sale_printing_url",payment:"payment_printing_url"},this.settings=t,this.options=r,this.type=_||"refund"}processRegularPrinting(t){const r=document.querySelector("printing-section");r&&r.remove();const _=this.settings[this.printingURL[this.type]].replace("{reference_id}",t),d=document.createElement("iframe");d.id="printing-section",d.className="hidden",d.src=_,document.body.appendChild(d),setTimeout(()=>{document.querySelector("#printing-section").remove()},5e3)}printOrder(t){switch(this.options.ns_pos_printing_gateway){case"default":this.processRegularPrinting(t);break;default:this.processCustomPrinting(t,this.options.ns_pos_printing_gateway);break}}processCustomPrinting(t,r){nsHooks.applyFilters("ns-order-custom-refund-print",{printed:!1,reference_id:t,gateway:r}).printed||nsSnackBar.error(__("Unsupported print gateway.")).subscribe()}}const he={components:{nsNumpad:q},props:["order"],computed:{screenValue(){let s=parseInt(1+new Array(parseInt(ns.currency.ns_currency_precision)).fill("").map(r=>0).join(""));return this.screen/s},total(){return this.refundables.length>0?this.refundables.map(s=>parseFloat(s.unit_price)*parseFloat(s.quantity)).reduce((s,t)=>s+t)+this.shippingFees:0+this.shippingFees},shippingFees(){return this.refundShipping?this.order.shipping:0}},data(){return{isSubmitting:!1,formValidation:new F,refundables:[],paymentOptions:[],paymentField:[],print:new U({settings:systemSettings,options:systemOptions,type:"refund"}),refundShipping:!1,selectedPaymentGateway:!1,screen:0,selectFields:[{type:"select",options:this.order.products.map(s=>({label:`${s.name} - ${s.unit.name} (x${s.quantity})`,value:s.id})),validation:"required",name:"product_id",label:c("Product"),description:c("Select the product to perform a refund.")}]}},methods:{__:c,updateScreen(s){this.screen=s},toggleRefundShipping(s){this.refundShipping=s,this.refundShipping},proceedPayment(){if(this.selectedPaymentGateway===!1)return m.error(c("Please select a payment gateway before proceeding.")).subscribe();if(this.total===0)return m.error(c("There is nothing to refund.")).subscribe();if(this.screenValue===0)return m.error(c("Please provide a valid payment amount.")).subscribe();j.show(S,{title:c("Confirm Your Action"),message:c("The refund will be made on the current order."),onAction:s=>{s&&this.doProceed()}})},doProceed(){const s={products:this.refundables,total:this.screenValue,payment:this.selectedPaymentGateway,refund_shipping:this.refundShipping};this.isSubmitting=!0,v.post(`/api/nexopos/v4/orders/${this.order.id}/refund`,s).subscribe({next:t=>{this.isSubmitting=!1,this.$emit("changed",!0),t.data.order.payment_status==="refunded"&&this.$emit("loadTab","details"),this.print.printOrder(t.data.orderRefund.id),m.success(t.message).subscribe()},error:t=>{this.isSubmitting=!1,m.error(t.message).subscribe()}})},addProduct(){if(this.formValidation.validateFields(this.selectFields),!this.formValidation.fieldsValid(this.selectFields))return m.error(c("Please select a product before proceeding.")).subscribe();const s=this.formValidation.extractFields(this.selectFields),t=this.order.products.filter(n=>n.id===s.product_id),r=this.refundables.filter(n=>n.id===s.product_id);if(r.length>0&&r.map(b=>parseInt(b.quantity)).reduce((b,o)=>b+o)===t[0].quantity)return m.error(c("Not enough quantity to proceed.")).subscribe();if(t[0].quantity===0)return m.error(c("Not enough quantity to proceed.")).subscribe();const _={...t[0],condition:"",description:""};new Promise((n,b)=>{j.show(B,{resolve:n,reject:b,product:_})}).then(n=>{n.quantity=this.getProductOriginalQuantity(n.id)-this.getProductUsedQuantity(n.id),this.refundables.push(n)},n=>n)},getProductOriginalQuantity(s){const t=this.order.products.filter(r=>r.id===s);return t.length>0?t.map(r=>parseFloat(r.quantity)).reduce((r,_)=>r+_):0},getProductUsedQuantity(s){const t=this.refundables.filter(r=>r.id===s);return t.length>0?t.map(_=>parseFloat(_.quantity)).reduce((_,d)=>_+d):0},openSettings(s){new Promise((r,_)=>{j.show(B,{resolve:r,reject:_,product:s})}).then(r=>{const _=this.refundables.indexOf(s);this.$set(this.refundables,_,r)},r=>r)},selectPaymentGateway(){new Promise((t,r)=>{j.show(M,{resolve:t,reject:r,value:[this.selectedPaymentOption],...this.paymentField[0]})}).then(t=>{this.selectedPaymentGateway=t[0]},t=>t)},changeQuantity(s){new Promise((r,_)=>{const d=this.getProductOriginalQuantity(s.id)-this.getProductUsedQuantity(s.id)+parseFloat(s.quantity);j.show(fe,{resolve:r,reject:_,product:s,availableQuantity:d})}).then(r=>{if(r.quantity>this.getProductUsedQuantity(s.id)-s.quantity){const _=this.refundables.indexOf(s);this.$set(this.refundables,_,r)}})},deleteProduct(s){new Promise((t,r)=>{j.show(S,{title:c("Confirm Your Action"),message:c("Would you like to delete this product ?"),onAction:_=>{if(_){const d=this.refundables.indexOf(s);this.refundables.splice(d,1)}}})})}},mounted(){this.selectFields=this.formValidation.createFields(this.selectFields),v.get("/api/nexopos/v4/orders/payments").subscribe(s=>{this.paymentField=s})}},be={class:"-m-4 flex-auto flex flex-wrap relative"},ye={key:0,class:"bg-overlay h-full w-full flex items-center justify-center absolute z-30"},ve={class:"px-4 w-full lg:w-1/2"},xe={class:"py-2 border-b-2 text-primary border-info-primary"},we={class:"my-2"},ge={class:"border-b border-info-primary flex justify-between items-center mb-2"},ke={class:"flex-auto flex-col flex"},Pe={class:"p-2 flex"},Ce={class:"flex justify-between p-2"},$e={class:"flex items-center text-primary"},Se={key:0,class:"mr-2"},je={class:"py-1 border-b-2 text-primary border-info-primary"},Ve={class:"px-2 text-primary flex justify-between flex-auto"},Oe={class:"flex flex-col"},Ae={class:"py-2"},Fe={key:0,class:"rounded-full px-2 py-1 text-xs bg-error-tertiary mx-2 text-white"},De={key:1,class:"rounded-full px-2 py-1 text-xs bg-success-tertiary mx-2 text-white"},Te={class:"flex items-center justify-center"},Re={class:"py-1 flex items-center cursor-pointer border-b border-dashed border-info-primary"},Ue={class:"flex"},Ie=["onClick"],qe=e("i",{class:"las la-cog text-xl"},null,-1),Qe=[qe],Ye=["onClick"],Ne=e("i",{class:"las la-trash"},null,-1),Be=[Ne],Ee=["onClick"],Ge={class:"px-4 w-full lg:w-1/2"},Le={class:"py-2 border-b-2 text-primary border-info-primary"},We={class:"py-2"},He={class:"elevation-surface border font-semibold flex mb-2 p-2 justify-between"},Me={class:"elevation-surface border success font-semibold flex mb-2 p-2 justify-between"},ze={class:"elevation-surface border font-semibold flex mb-2 p-2 justify-between"};function Je(s,t,r,_,d,n){const b=h("ns-spinner"),o=h("ns-field"),u=h("ns-checkbox"),g=h("ns-numpad");return l(),a("div",be,[d.isSubmitting?(l(),a("div",ye,[y(b)])):p("",!0),e("div",ve,[e("h3",xe,i(n.__("Refund With Products")),1),e("div",we,[e("ul",null,[e("li",ge,[e("div",ke,[e("div",Pe,[(l(!0),a(x,null,w(d.selectFields,(f,C)=>(l(),P(o,{field:f,key:C},null,8,["field"]))),128))]),e("div",Ce,[e("div",$e,[r.order.shipping>0?(l(),a("span",Se,i(n.__("Refund Shipping")),1)):p("",!0),r.order.shipping>0?(l(),P(u,{key:1,onChange:t[0]||(t[0]=f=>n.toggleRefundShipping(f)),checked:d.refundShipping},null,8,["checked"])):p("",!0)]),e("div",null,[e("button",{onClick:t[1]||(t[1]=f=>n.addProduct()),class:"border rounded-full px-2 py-1 ns-inset-button info"},i(n.__("Add Product")),1)])])])]),e("li",null,[e("h4",je,i(n.__("Products")),1)]),(l(!0),a(x,null,w(d.refundables,f=>(l(),a("li",{key:f.id,class:"elevation-surface border flex justify-between items-center mb-2"},[e("div",Ve,[e("div",Oe,[e("p",Ae,[e("span",null,i(f.name),1),f.condition==="damaged"?(l(),a("span",Fe,i(n.__("Damaged")),1)):p("",!0),f.condition==="unspoiled"?(l(),a("span",De,i(n.__("Unspoiled")),1)):p("",!0)]),e("small",null,i(f.unit.name),1)]),e("div",Te,[e("span",Re,i(s.nsCurrency(f.unit_price*f.quantity)),1)])]),e("div",Ue,[e("p",{onClick:C=>n.openSettings(f),class:"p-2 border-l border-info-primary cursor-pointer text-primary ns-numpad-key w-16 h-16 flex items-center justify-center"},Qe,8,Ie),e("p",{onClick:C=>n.deleteProduct(f),class:"p-2 border-l border-info-primary cursor-pointer text-primary ns-numpad-key w-16 h-16 flex items-center justify-center"},Be,8,Ye),e("p",{onClick:C=>n.changeQuantity(f),class:"p-2 border-l border-info-primary cursor-pointer text-primary ns-numpad-key w-16 h-16 flex items-center justify-center"},i(f.quantity),9,Ee)])]))),128))])])]),e("div",Ge,[e("h3",Le,i(n.__("Summary")),1),e("div",We,[e("div",He,[e("span",null,i(n.__("Total")),1),e("span",null,i(s.nsCurrency(n.total)),1)]),e("div",Me,[e("span",null,i(n.__("Paid")),1),e("span",null,i(s.nsCurrency(r.order.tendered)),1)]),e("div",{onClick:t[2]||(t[2]=f=>n.selectPaymentGateway()),class:"elevation-surface border info font-semibold flex mb-2 p-2 justify-between cursor-pointer"},[e("span",null,i(n.__("Payment Gateway")),1),e("span",null,i(d.selectedPaymentGateway?d.selectedPaymentGateway.label:"N/A"),1)]),e("div",ze,[e("span",null,i(n.__("Screen")),1),e("span",null,i(s.nsCurrency(n.screenValue)),1)]),e("div",null,[y(g,{currency:!0,onChanged:t[3]||(t[3]=f=>n.updateScreen(f)),value:d.screen,onNext:t[4]||(t[4]=f=>n.proceedPayment(f))},null,8,["value"])])])])])}var Ke=O(he,[["render",Je]]);class Q{getTypeLabel(t){const r=typeLabels.filter(_=>_.value===t);return r.length>0?r[0].label:c("Unknown Status")}getDeliveryStatus(t){const r=deliveryStatuses.filter(_=>_.value===t);return r.length>0?r[0].label:c("Unknown Status")}getProcessingStatus(t){const r=processingStatuses.filter(_=>_.value===t);return r.length>0?r[0].label:c("Unknown Status")}getPaymentStatus(t){const r=paymentLabels.filter(_=>_.value===t);return r.length>0?r[0].label:c("Unknown Status")}}const Xe={props:["order"],data(){return{labels:new Q,validation:new F,inputValue:0,fields:[],paymentTypes}},computed:{paymentsLabels(){const s=new Object;return this.paymentTypes.forEach(t=>{s[t.value]=t.label}),s}},methods:{__:c,nsCurrency:R,updateValue(s){this.inputValue=s},loadPaymentFields(){v.get("/api/nexopos/v4/orders/payments").subscribe(s=>{this.fields=this.validation.createFields(s)})},submitPayment(s){if(this.validation.validateFields(this.fields),!this.validation.fieldsValid(this.fields))return m.error(c("Unable to proceed the form is not valid")).subscribe();if(parseFloat(s)==0)return m.error(c("Please provide a valid value")).subscribe();s=parseFloat(s);const t={...this.validation.extractFields(this.fields),value:s};Popup.show(S,{title:c("Confirm Your Action"),message:c("You make a payment for {amount}. A payment can't be canceled. Would you like to proceed ?").replace("{amount}",this.$options.filters.currency(s)),onAction:r=>{r&&v.post(`/api/nexopos/v4/orders/${this.order.id}/payments`,t).subscribe(_=>{m.success(_.message).subscribe(),this.$emit("changed")},_=>{m.error(_.message).subscribe()})}})}},components:{nsNumpad:q},mounted(){this.loadPaymentFields()}},Ze={class:""},es={class:"flex -mx-4 flex-wrap"},ss={class:"px-2 w-full md:w-1/2"},ts={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface info border text-xl font-bold"},rs={class:"px-2 w-full md:w-1/2"},is={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface success border text-xl font-bold"},os={class:"px-2 w-full md:w-1/2"},ls={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface error border text-xl font-bold"},ds={key:0},as={key:1},cs={class:"px-2 w-full md:w-1/2"},us={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface warning border text-xl font-bold"},_s={class:"flex -mx-4 flex-wrap"},ps={class:"px-2 w-full mb-4 md:w-1/2"},ms={key:0},fs={class:"font-semibold border-b-2 border-info-primary py-2"},hs={class:"py-2"},bs={class:"my-2 px-2 h-12 flex justify-end items-center border elevation-surface"},ys={key:1,class:"flex items-center justify-center h-full"},vs={class:"text-primary font-semibold"},xs={class:"px-2 w-full mb-4 md:w-1/2"},ws={class:"font-semibold border-b-2 border-info-primary py-2 mb-2"};function gs(s,t,r,_,d,n){const b=h("ns-field"),o=h("ns-numpad");return l(),a("div",Ze,[e("div",es,[e("div",ss,[e("div",ts,[e("span",null,i(n.__("Total")),1),e("span",null,i(n.nsCurrency(r.order.total)),1)])]),e("div",rs,[e("div",is,[e("span",null,i(n.__("Paid")),1),e("span",null,i(n.nsCurrency(r.order.tendered)),1)])]),e("div",os,[e("div",ls,[e("span",null,i(n.__("Unpaid")),1),r.order.total-r.order.tendered>0?(l(),a("span",ds,i(n.nsCurrency(r.order.total-r.order.tendered)),1)):p("",!0),r.order.total-r.order.tendered<=0?(l(),a("span",as,i(n.nsCurrency(0)),1)):p("",!0)])]),e("div",cs,[e("div",us,[e("span",null,i(n.__("Customer Account")),1),e("span",null,i(n.nsCurrency(r.order.customer.account_amount)),1)])])]),e("div",_s,[e("div",ps,[r.order.payment_status!=="paid"?(l(),a("div",ms,[e("h3",fs,i(n.__("Payment")),1),e("div",hs,[(l(!0),a(x,null,w(d.fields,(u,g)=>(l(),P(b,{field:u,key:g},null,8,["field"]))),128)),e("div",bs,i(n.nsCurrency(d.inputValue)),1),y(o,{floating:!0,onNext:t[0]||(t[0]=u=>n.submitPayment(u)),onChanged:t[1]||(t[1]=u=>n.updateValue(u)),value:d.inputValue},null,8,["value"])])])):p("",!0),r.order.payment_status==="paid"?(l(),a("div",ys,[e("h3",vs,i(n.__("No payment possible for paid order.")),1)])):p("",!0)]),e("div",xs,[e("h3",ws,i(n.__("Payment History")),1),e("ul",null,[(l(!0),a(x,null,w(r.order.payments,u=>(l(),a("li",{key:u.id,class:"p-2 flex items-center justify-between text-shite border elevation-surface mb-2"},[e("span",null,i(n.paymentsLabels[u.identifier]||n.__("Unknown")),1),e("span",null,i(n.nsCurrency(u.value)),1)]))),128))])])])])}var ks=O(Xe,[["render",gs]]);const Ps={name:"ns-orders-refund-popup",data(){return{order:null,refunds:[],view:"summary",previewed:null,loaded:!1,options:systemOptions,settings:systemSettings,print:new U({settings:systemSettings,options:systemOptions,type:"refund"})}},methods:{__:c,nsCurrency:R,popupCloser:D,popupResolver:T,toggleProductView(s){this.view="details",this.previewed=s},loadOrderRefunds(){nsHttpClient.get(`/api/nexopos/v4/orders/${this.order.id}/refunds`).subscribe(s=>{this.loaded=!0,this.refunds=s.refunds},s=>{m.error(s.message).subscribe()})},close(){this.$popup.close()},printRefundReceipt(s){this.print.printOrder(s.id)}},mounted(){this.order=this.$popupParams.order,this.popupCloser(),this.loadOrderRefunds()}},Cs={class:"shadow-lg w-95vw h-95vh md:w-3/5-screen md:h-3/5-screen ns-box flex flex-col overflow-hidden"},$s={class:"border-b p-2 flex items-center justify-between ns-box-header"},Ss={class:"flex"},js={class:"overflow-auto flex-auto ns-box-body"},Vs={key:0,class:"flex h-full w-full items-center justify-center"},Os={key:1,class:"flex h-full w-full items-center justify-center"},As=e("i",{class:"lar la-frown-open"},null,-1),Fs=[As],Ds={class:"w-full md:flex-auto p-2"},Ts={class:"font-semibold mb-1"},Rs={class:"flex -mx-1 text-sm text-primary"},Us={class:"px-1"},Is={class:"px-1"},qs=["onClick"],Qs=e("i",{class:"las la-eye"},null,-1),Ys=[Qs],Ns=["onClick"],Bs=e("i",{class:"las la-print"},null,-1),Es=[Bs],Gs={class:"w-full md:flex-auto p-2"},Ls={class:"font-semibold mb-1"},Ws={class:"flex -mx-1 text-sm text-primary"},Hs={class:"px-1"},Ms={class:"px-1"},zs={class:"px-1"};function Js(s,t,r,_,d,n){const b=h("ns-close-button"),o=h("ns-spinner");return l(),a("div",Cs,[e("div",$s,[e("h3",null,i(n.__("Order Refunds")),1),e("div",Ss,[d.view==="details"?(l(),a("div",{key:0,onClick:t[0]||(t[0]=u=>d.view="summary"),class:"flex items-center justify-center cursor-pointer rounded-full px-3 border hover:bg-info-primary hover:text-white mr-1"},i(n.__("Go Back")),1)):p("",!0),y(b,{onClick:t[1]||(t[1]=u=>n.close())})])]),e("div",js,[d.view==="summary"?(l(),a(x,{key:0},[d.loaded?p("",!0):(l(),a("div",Vs,[y(o,{size:"24"})])),d.loaded&&d.refunds.length===0?(l(),a("div",Os,Fs)):p("",!0),d.loaded&&d.refunds.length>0?(l(!0),a(x,{key:2},w(d.refunds,u=>(l(),a("div",{class:"border-b flex flex-col md:flex-row",key:u.id},[e("div",Ds,[e("h3",Ts,i(d.order.code),1),e("div",null,[e("ul",Rs,[e("li",Us,i(n.__("Total"))+" : "+i(n.nsCurrency(u.total)),1),e("li",Is,i(n.__("By"))+" : "+i(u.author.username),1)])])]),e("div",{onClick:g=>n.toggleProductView(u),class:"w-full md:w-16 cursor-pointer hover:bg-info-primary hover:border-info-primary hover:text-white text-lg flex items-center justify-center md:border-l"},Ys,8,qs),e("div",{onClick:g=>n.printRefundReceipt(u),class:"w-full md:w-16 cursor-pointer hover:bg-info-primary hover:border-info-primary hover:text-white text-lg flex items-center justify-center md:border-l"},Es,8,Ns)]))),128)):p("",!0)],64)):p("",!0),d.view==="details"?(l(!0),a(x,{key:1},w(d.previewed.refunded_products,u=>(l(),a("div",{class:"border-b flex flex-col md:flex-row",key:u.id},[e("div",Gs,[e("h3",Ls,i(u.product.name),1),e("div",null,[e("ul",Ws,[e("li",Hs,i(n.__("Condition"))+" : "+i(u.condition),1),e("li",Ms,i(n.__("Quantity"))+" : "+i(u.quantity),1),e("li",zs,i(n.__("Total"))+" : "+i(n.nsCurrency(u.total_price)),1)])])])]))),128)):p("",!0)])])}var Ks=O(Ps,[["render",Js]]);const Xs={props:["order"],data(){return{processingStatuses,deliveryStatuses,labels:new Q,showProcessingSelect:!1,showDeliverySelect:!1}},mounted(){},methods:{__:c,submitProcessingChange(){j.show(S,{title:c("Would you proceed ?"),message:c("The processing status of the order will be changed. Please confirm your action."),onAction:s=>{s&&v.post(`/api/nexopos/v4/orders/${this.order.id}/processing`,{process_status:this.order.process_status}).subscribe({next:t=>{this.showProcessingSelect=!1,m.success(t.message).subscribe()},error:t=>{m.error(t.message||c("Unexpected error occured.")).subscribe()}})}})},openRefunds(){try{const s=new Promise((t,r)=>{const _=this.order;j.show(Ks,{order:_,resolve:t,reject:r})})}catch{}},submitDeliveryStatus(){j.show(S,{title:c("Would you proceed ?"),message:c("The delivery status of the order will be changed. Please confirm your action."),onAction:s=>{s&&v.post(`/api/nexopos/v4/orders/${this.order.id}/delivery`,{delivery_status:this.order.delivery_status}).subscribe({next:t=>{this.showDeliverySelect=!1,m.success(t.message).subscribe()},error:t=>{m.error(t.message||c("Unexpected error occured.")).subscribe()}})}})}}},Zs={class:"-mx-4 flex flex-wrap"},et={class:"flex-auto"},st={class:"w-full mb-2 flex-wrap flex"},tt={class:"w-full mb-2 px-4"},nt={class:"font-semibold text-secondary pb-2 border-b border-info-primary"},rt={class:"mb-2 w-full md:w-1/2 px-4"},it={class:"elevation-surface border p-2 flex justify-between items-start"},ot={class:"text-semibold text-primary"},lt={class:"font-semibold text-secondary"},dt={class:"mb-2 w-full md:w-1/2 px-4"},at={class:"p-2 flex justify-between items-start ns-notice error"},ct={class:"text-semibold"},ut={class:"text-white"},_t={key:0,class:"text-white ml-1"},pt={key:1,class:"text-white ml-1"},mt={class:"font-semibold"},ft={class:"mb-2 w-full md:w-1/2 px-4"},ht={class:"p-2 flex justify-between items-start elevation-surface border"},bt={class:"text-semibold text-primary"},yt={class:"font-semibold text-secondary"},vt={class:"mb-2 w-full md:w-1/2 px-4"},xt={class:"p-2 flex justify-between items-start ns-notice error"},wt={class:"text-semibold"},gt={class:"font-semibold"},kt={class:"mb-2 w-full md:w-1/2 px-4"},Pt={class:"p-2 flex justify-between items-start ns-notice info"},Ct={class:"text-semibold"},$t={class:"font-semibold"},St={class:"mb-2 w-full md:w-1/2 px-4"},jt={class:"p-2 flex justify-between items-start ns-notice warning"},Vt={class:"text-semibold"},Ot={class:"font-semibold"},At={class:"mb-2 w-full md:w-1/2 px-4"},Ft={class:"p-2 flex justify-between items-start text-primary elevation-surface error border"},Dt={class:"text-semibold"},Tt={class:"font-semibold"},Rt={class:"mb-2 w-full md:w-1/2 px-4"},Ut={class:"p-2 flex justify-between items-start elevation-surface border"},It={class:"text-semibold"},qt={class:"font-semibold"},Qt={class:"px-4 w-full md:w-1/2 lg:w-2/4 mb-2"},Yt={class:"mb-2"},Nt={class:"font-semibold text-secondary pb-2 border-b border-info-primary"},Bt={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},Et={class:"text-semibold text-primary"},Gt={class:"font-semibold text-secondary"},Lt={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},Wt={class:"text-semibold text-primary"},Ht={class:"font-semibold text-secondary"},Mt={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},zt={class:"text-semibold text-primary"},Jt={class:"font-semibold text-secondary mt-2 md:mt-0 w-full md:w-auto"},Kt={class:"w-full text-center"},Xt={key:0,class:"flex-auto flex"},Zt={class:"ns-select flex items-center justify-center"},en=["value"],sn={class:"pl-2 flex"},tn={class:"mb-2 p-2 flex flex-col md:flex-row justify-between items-center elevation-surface border"},nn={class:"text-semibold text-primary"},rn={class:"font-semibold text-secondary mt-2 md:mt-0 w-full md:w-auto"},on={class:"w-full text-center"},ln={key:0,class:"flex-auto flex"},dn={class:"ns-select flex items-center justify-center"},an=["value"],cn={class:"pl-2 flex"},un={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},_n={class:"text-semibold text-primary"},pn={class:"font-semibold text-secondary"},mn={class:"px-4 w-full md:w-1/2 lg:w-2/4 mb-2"},fn={class:"mb-2"},hn={class:"font-semibold text-secondary pb-2 border-b border-info-primary"},bn={class:"text-semibold text-primary"},yn={class:"text-secondary text-sm"},vn={class:"font-semibold text-secondary"},xn={class:"mb-2"},wn={class:"font-semibold text-secondary pb-2 border-b border-info-primary flex justify-between"},gn={class:"text-semibold text-primary"},kn={class:"text-secondary text-sm"},Pn={class:"font-semibold text-secondary"};function Cn(s,t,r,_,d,n){const b=h("ns-close-button");return l(),a("div",Zs,[e("div",et,[e("div",st,[e("div",tt,[e("h3",nt,i(n.__("Payment Summary")),1)]),e("div",rt,[e("div",it,[e("div",null,[e("h4",ot,i(n.__("Sub Total")),1)]),e("div",lt,i(s.nsCurrency(r.order.subtotal)),1)])]),e("div",dt,[e("div",at,[e("div",null,[e("h4",ct,[e("span",ut,i(n.__("Discount")),1),r.order.discount_type==="percentage"?(l(),a("span",_t,"("+i(r.order.discount_percentage)+"%)",1)):p("",!0),r.order.discount_type==="flat"?(l(),a("span",pt,"(Flat)")):p("",!0)])]),e("div",mt,i(s.nsCurrency(r.order.discount)),1)])]),e("div",ft,[e("div",ht,[e("div",null,[e("h4",bt,i(n.__("Shipping")),1)]),e("div",yt,i(s.nsCurrency(r.order.shipping)),1)])]),e("div",vt,[e("div",xt,[e("div",null,[e("h4",wt,i(n.__("Coupons")),1)]),e("div",gt,i(s.nsCurrency(r.order.total_coupons)),1)])]),e("div",kt,[e("div",Pt,[e("div",null,[e("h4",Ct,i(n.__("Total")),1)]),e("div",$t,i(s.nsCurrency(r.order.total)),1)])]),e("div",St,[e("div",jt,[e("div",null,[e("h4",Vt,i(n.__("Taxes")),1)]),e("div",Ot,i(s.nsCurrency(r.order.tax_value)),1)])]),e("div",At,[e("div",Ft,[e("div",null,[e("h4",Dt,i(n.__("Change")),1)]),e("div",Tt,i(s.nsCurrency(r.order.change)),1)])]),e("div",Rt,[e("div",Ut,[e("div",null,[e("h4",It,i(n.__("Paid")),1)]),e("div",qt,i(s.nsCurrency(r.order.tendered)),1)])])])]),e("div",Qt,[e("div",Yt,[e("h3",Nt,i(n.__("Order Status")),1)]),e("div",Bt,[e("div",null,[e("h4",Et,[e("span",null,i(n.__("Customer")),1)])]),e("div",Gt,i(r.order.nexopos_customers_name),1)]),e("div",Lt,[e("div",null,[e("h4",Wt,[e("span",null,i(n.__("Type")),1)])]),e("div",Ht,i(d.labels.getTypeLabel(r.order.type)),1)]),e("div",Mt,[e("div",null,[e("h4",zt,[e("span",null,i(n.__("Delivery Status")),1)])]),e("div",Jt,[e("div",Kt,[d.showDeliverySelect?p("",!0):(l(),a("span",{key:0,onClick:t[0]||(t[0]=o=>d.showDeliverySelect=!0),class:"font-semibold text-secondary border-b border-info-primary cursor-pointer border-dashed"},i(d.labels.getDeliveryStatus(r.order.delivery_status)),1))]),d.showDeliverySelect?(l(),a("div",Xt,[e("div",Zt,[A(e("select",{ref:"process_status",class:"flex-auto border-info-primary rounded-lg","onUpdate:modelValue":t[1]||(t[1]=o=>r.order.delivery_status=o)},[(l(!0),a(x,null,w(d.deliveryStatuses,(o,u)=>(l(),a("option",{key:u,value:o.value},i(o.label),9,en))),128))],512),[[Y,r.order.delivery_status]])]),e("div",sn,[y(b,{onClick:t[2]||(t[2]=o=>d.showDeliverySelect=!1)}),e("button",{onClick:t[3]||(t[3]=o=>n.submitDeliveryStatus(r.order)),class:"bg-success-primary text-white rounded-full px-2 py-1"},i(n.__("Save")),1)])])):p("",!0)])]),e("div",tn,[e("div",null,[e("h4",nn,[e("span",null,i(n.__("Processing Status")),1)])]),e("div",rn,[e("div",on,[d.showProcessingSelect?p("",!0):(l(),a("span",{key:0,onClick:t[4]||(t[4]=o=>d.showProcessingSelect=!0),class:"border-b border-info-primary cursor-pointer border-dashed"},i(d.labels.getProcessingStatus(r.order.process_status)),1))]),d.showProcessingSelect?(l(),a("div",ln,[e("div",dn,[A(e("select",{ref:"process_status",class:"flex-auto border-info-primary rounded-lg","onUpdate:modelValue":t[5]||(t[5]=o=>r.order.process_status=o)},[(l(!0),a(x,null,w(d.processingStatuses,(o,u)=>(l(),a("option",{key:u,value:o.value},i(o.label),9,an))),128))],512),[[Y,r.order.process_status]])]),e("div",cn,[y(b,{onClick:t[6]||(t[6]=o=>d.showProcessingSelect=!1)}),e("button",{onClick:t[7]||(t[7]=o=>n.submitProcessingChange(r.order)),class:"bg-success-primary text-white rounded-full px-2 py-1"},i(n.__("Save")),1)])])):p("",!0)])]),e("div",un,[e("div",null,[e("h4",_n,[e("span",null,i(n.__("Payment Status")),1)])]),e("div",pn,i(d.labels.getPaymentStatus(r.order.payment_status)),1)])]),e("div",mn,[e("div",fn,[e("h3",hn,i(n.__("Products")),1)]),(l(!0),a(x,null,w(r.order.products,o=>(l(),a("div",{key:o.id,class:"p-2 flex justify-between items-start elevation-surface border mb-6"},[e("div",null,[e("h4",bn,i(o.name)+" (x"+i(o.quantity)+")",1),e("p",yn,i(o.unit.name||"N/A"),1)]),e("div",vn,i(s.nsCurrency(o.total_price)),1)]))),128)),e("div",xn,[e("h3",wn,[e("span",null,i(n.__("Refunded Products")),1),e("a",{href:"javascript:void(0)",onClick:t[8]||(t[8]=o=>n.openRefunds()),class:"border-b border-info-primary border-dashed"},i(n.__("All Refunds")),1)])]),(l(!0),a(x,null,w(r.order.refunded_products,o=>(l(),a("div",{key:o.id,class:"p-2 flex justify-between items-start elevation-surface border mb-6"},[e("div",null,[e("h4",gn,i(o.order_product.name)+" (x"+i(o.quantity)+")",1),e("p",kn,[V(i(o.unit.name||"N/A")+" | ",1),e("span",{class:E(["rounded-full px-2",o.condition==="damaged"?"bg-error-tertiary text-white":"bg-info-tertiary text-white"])},i(o.condition),3)])]),e("div",Pn,i(s.nsCurrency(o.total_price)),1)]))),128))])])}var $n=O(Xs,[["render",Cn]]);const Sn={name:"ns-order-instalments-payment",components:{nsNotice:z},data(){return{paymentTypes,fields:[{type:"select",name:"payment_type",description:c("Select the payment type that must apply to the current order."),label:c("Payment Type"),validation:"required",options:paymentTypes}],print:new U({settings:systemSettings,options:systemOptions,type:"payment"}),validation:new F,order:null,instalment:null}},methods:{__:c,popupResolver:T,popupCloser:D,close(){this.popupResolver(!1)},updateInstalmentAsDue(s){nsHttpClient.put(`/api/nexopos/v4/orders/${this.order.id}/instalments/${this.instalment.id}/`,{instalment:{date:ns.date.moment.format("YYYY-MM-DD HH:mm:ss")}}).subscribe({next:t=>{this.submitPayment()},error:t=>{m.error(t.message||c("An unexpected error has occured")).subscribe()}})},submitPayment(){if(!this.validation.validateFields(this.fields))return m.error(__m("The form is not valid.")).subcribe();nsHttpClient.post(`/api/nexopos/v4/orders/${this.order.id}/instalments/${this.instalment.id}/pay`,{...this.validation.extractFields(this.fields)}).subscribe({next:s=>{this.popupResolver(!0),this.print.printOrder(s.data.payment.id),m.success(s.message).subscribe()},error:s=>{s.status==="failed"&&Popup.show(S,{title:c("Update Instalment Date"),message:c("Would you like to mark that instalment as due today ? If you confirm the instalment will be marked as paid."),onAction:t=>{t&&this.updateInstalmentAsDue(this.instalment)}}),m.error(s.message||c("An unexpected error has occured")).subscribe()}})}},mounted(){this.popupCloser(),this.order=this.$popupParams.order,this.instalment=this.$popupParams.instalment,this.fields=this.validation.createFields(this.fields)}},jn={class:"shadow-lg ns-box w-95vw md:w-2/3-screen lg:w-1/3-screen"},Vn={class:"p-2 flex justify-between border-b items-center"},On={class:"p-2 ns-box-body"},An=e("br",null,null,-1),Fn={class:"border-t ns-box-footer p-2 flex justify-end"};function Dn(s,t,r,_,d,n){const b=h("ns-close-button"),o=h("ns-notice"),u=h("ns-field"),g=h("ns-button");return l(),a("div",jn,[e("div",Vn,[e("h3",null,i(n.__("Payment Method")),1),e("div",null,[y(b,{onClick:t[0]||(t[0]=f=>n.close())})])]),e("div",On,[y(o,{color:"info",class:"py-2 p-4 text-center border text-primary rounded-lg"},{default:k(()=>[V(i(n.__("Before submitting the payment, choose the payment type used for that order.")),1)]),_:1}),An,(l(!0),a(x,null,w(d.fields,(f,C)=>(l(),P(u,{key:C,field:f},null,8,["field"]))),128))]),e("div",Fn,[y(g,{onClick:t[1]||(t[1]=f=>n.submitPayment()),type:"info"},{default:k(()=>[V(i(n.__("Submit Payment")),1)]),_:1})])])}var Tn=O(Sn,[["render",Dn]]);const Rn={props:["order"],name:"ns-order-instalments",data(){return{labels:new Q,original:[],instalments:[],print:new U({settings:systemSettings,options:systemOptions,type:"payment"})}},mounted(){this.loadInstalments()},computed:{totalInstalments(){return this.instalments.length>0?this.instalments.map(s=>s.amount).reduce((s,t)=>parseFloat(s)+parseFloat(t)):0}},methods:{__:c,nsCurrency:R,loadInstalments(){v.get(`/api/nexopos/v4/orders/${this.order.id}/instalments`).subscribe(s=>{this.original=s,this.instalments=s.map(t=>(t.price_clicked=!1,t.date_clicked=!1,t.date=moment(t.date).format("YYYY-MM-DD"),t))})},showReceipt(s){if(s.payment_id===null)return m.error(c("This instalment doesn't have any payment attached.")).subscribe();this.print.printOrder(s.payment_id)},addInstalment(){this.instalments.push({date:ns.date.moment.format("YYYY-MM-DD"),amount:this.order.total-this.totalInstalments,paid:!1})},createInstalment(s){Popup.show(S,{title:c("Confirm Your Action"),message:c("Would you like to create this instalment ?"),onAction:t=>{t&&v.post(`/api/nexopos/v4/orders/${this.order.id}/instalments`,{instalment:s}).subscribe({next:r=>{this.loadInstalments(),m.success(r.message).subscribe()},error:r=>{m.error(r.message||c("An unexpected error has occured")).subscribe()}})}})},deleteInstalment(s){Popup.show(S,{title:c("Confirm Your Action"),message:c("Would you like to delete this instalment ?"),onAction:t=>{t&&v.delete(`/api/nexopos/v4/orders/${this.order.id}/instalments/${s.id}`).subscribe({next:r=>{const _=this.instalments.indexOf(s);this.instalments.splice(_,1),m.success(r.message).subscribe()},error:r=>{m.error(r.message||c("An unexpected error has occured")).subscribe()}})}})},async markAsPaid(s){try{const t=await new Promise((r,_)=>{Popup.show(Tn,{order:this.order,instalment:s,resolve:r,reject:_})});this.loadInstalments()}catch{}},togglePriceEdition(s){s.paid||(s.price_clicked=!s.price_clicked,this.$forceUpdate(),s.price_clicked&&setTimeout(()=>{this.$refs.amount[0].select()},100))},updateInstalment(s){Popup.show(S,{title:c("Confirm Your Action"),message:c("Would you like to update that instalment ?"),onAction:t=>{t&&v.put(`/api/nexopos/v4/orders/${this.order.id}/instalments/${s.id}`,{instalment:s}).subscribe({next:r=>{m.success(r.message).subscribe()},error:r=>{m.error(r.message||c("An unexpected error has occured")).subscribe()}})}})},toggleDateEdition(s){s.paid||(s.date_clicked=!s.date_clicked,this.$forceUpdate(),s.date_clicked&&setTimeout(()=>{this.$refs.date[0].select()},200))}}},Un={class:"-mx-4 flex-auto flex flex-wrap"},In={class:"flex flex-auto"},qn={class:"w-full mb-2 flex-wrap"},Qn={class:"w-full mb-2 px-4"},Yn={class:"font-semibold text-secondary pb-2 border-b border-info-primary"},Nn={class:"px-4"},Bn={class:"border-table-th-edge border-t text-primary"},En={class:"p-2"},Gn=["onClick"],Ln={key:1},Wn=["onBlur","onUpdate:modelValue"],Hn={class:"flex items-center"},Mn={class:"flex items-center px-2 h-full border-r"},zn=["onClick"],Jn={key:1},Kn=["onUpdate:modelValue","onBlur"],Xn={key:0,class:"w-36 justify-center flex items-center px-2 h-full border-r"},Zn={class:"px-2"},er={class:"px-2"},sr={class:"px-2"},tr={key:1,class:"w-36 justify-center flex items-center px-2 h-full border-r"},nr={class:"px-2"},rr={class:"ns-button info"},ir=["onClick"],or=e("i",{class:"las la-plus"},null,-1),lr={key:2,class:"w-36 justify-center flex items-center px-2 h-full"},dr={class:"ns-button info"},ar=["onClick"],cr=e("i",{class:"las la-print"},null,-1),ur={class:"flex justify-between p-2 border-r border-b border-l elevation-surface"},_r={class:"flex items-center justify-center"},pr={class:"ml-1 text-sm"},mr={class:"-mx-2 flex flex-wrap items-center"},fr={class:"px-2"},hr={class:"px-2"},br={class:"ns-button info"};function yr(s,t,r,_,d,n){const b=h("ns-icon-button");return l(),a("div",Un,[e("div",In,[e("div",qn,[e("div",Qn,[e("h3",Yn,i(n.__("Instalments")),1)]),e("div",Nn,[e("ul",Bn,[(l(!0),a(x,null,w(d.instalments,o=>(l(),a("li",{class:E([o.paid?"success":"info","border-b border-l flex justify-between elevation-surface"]),key:o.id},[e("span",En,[o.date_clicked?p("",!0):(l(),a("span",{key:0,onClick:u=>n.toggleDateEdition(o)},i(o.date),9,Gn)),o.date_clicked?(l(),a("span",Ln,[A(e("input",{onBlur:u=>n.toggleDateEdition(o),"onUpdate:modelValue":u=>o.date=u,type:"date",ref_for:!0,ref:"date",class:"border border-info-primary rounded"},null,40,Wn),[[N,o.date]])])):p("",!0)]),e("div",Hn,[e("div",Mn,[o.price_clicked?p("",!0):(l(),a("span",{key:0,onClick:u=>n.togglePriceEdition(o)},i(n.nsCurrency(o.amount)),9,zn)),o.price_clicked?(l(),a("span",Jn,[A(e("input",{ref_for:!0,ref:"amount","onUpdate:modelValue":u=>o.amount=u,onBlur:u=>n.togglePriceEdition(o),type:"text",class:"border border-info-primary p-1"},null,40,Kn),[[N,o.amount]])])):p("",!0)]),!o.paid&&o.id?(l(),a("div",Xn,[e("div",Zn,[y(b,{type:"success",onClick:u=>n.markAsPaid(o),className:"la-money-bill-wave-alt"},null,8,["onClick"])]),e("div",er,[y(b,{type:"info",onClick:u=>n.updateInstalment(o),className:"la-save"},null,8,["onClick"])]),e("div",sr,[y(b,{type:"error",onClick:u=>n.deleteInstalment(o),className:"la-trash-alt"},null,8,["onClick"])])])):p("",!0),!o.paid&&!o.id?(l(),a("div",tr,[e("div",nr,[e("div",rr,[e("button",{onClick:u=>n.createInstalment(o),class:"px-3 py-1 rounded-full"},[or,V(" "+i(n.__("Create")),1)],8,ir)])])])):p("",!0),o.paid?(l(),a("div",lr,[e("div",dr,[e("button",{onClick:u=>n.showReceipt(o),class:"px-3 text-xs py-1 rounded-full"},[cr,V(" "+i(n.__("Receipt")),1)],8,ar)])])):p("",!0)])],2))),128)),e("li",ur,[e("div",_r,[e("span",null,i(n.__("Total :"))+" "+i(n.nsCurrency(r.order.total)),1),e("span",pr," ("+i(n.__("Remaining :"))+" "+i(n.nsCurrency(r.order.total-n.totalInstalments))+") ",1)]),e("div",mr,[e("span",fr,i(n.__("Instalments:"))+" "+i(n.nsCurrency(n.totalInstalments)),1),e("span",hr,[e("div",br,[e("button",{onClick:t[0]||(t[0]=o=>n.addInstalment()),class:"rounded-full px-3 py-1"},i(n.__("Add Instalment")),1)])])])])])])])])])}var vr=O(Rn,[["render",yr]]);const G={filters:{nsCurrency:R},name:"ns-preview-popup",data(){return{active:"details",order:new Object,products:[],payments:[],options:null,settings:null}},components:{nsOrderRefund:Ke,nsOrderPayment:ks,nsOrderDetails:$n,nsOrderInstalments:vr},computed:{isVoidable(){return["paid","partially_paid","unpaid"].includes(this.order.payment_status)},isDeleteAble(){return["hold"].includes(this.order.payment_status)}},methods:{__:c,popupResolver:T,popupCloser:D,closePopup(s=!1){this.popupResolver(s)},setActive(s){this.active=s},refresh(){this.$popupParams.component.$emit("updated"),this.loadOrderDetails(this.order.id)},printOrder(){switch(this.options.ns_pos_printing_gateway){case"default":this.processRegularPrinting(this.order.id);break;default:this.processCustomPrinting(this.order.id,this.options.ns_pos_printing_gateway,!1);break}},async processCustomPrinting(s,t,r=!0){nsHooks.applyFilters(r?"ns-order-custom-print":"ns-order-custom-print-aloud",{printed:!1,order_id:s,gateway:t}).printed===!1&&m.error(c("Unsupported print gateway.")).subscribe()},processRegularPrinting(s){const t=document.querySelector("printing-section");t&&t.remove();const r=document.createElement("iframe");r.id="printing-section",r.className="hidden",r.src=this.settings.sale_printing_url.replace("{reference_id}",s),document.body.appendChild(r)},loadOrderDetails(s){H([v.get(`/api/nexopos/v4/orders/${s}`),v.get(`/api/nexopos/v4/orders/${s}/products`),v.get(`/api/nexopos/v4/orders/${s}/payments`)]).subscribe(t=>{this.order=t[0],this.products=t[1],this.payments=t[2]})},deleteOrder(){Popup.show(S,{title:c("Confirm Your Action"),message:c("Would you like to delete this order"),onAction:s=>{s&&v.delete(`/api/nexopos/v4/orders/${this.order.id}`).subscribe({next:t=>{m.success(t.message).subscribe(),this.refreshCrudTable(),this.closePopup(!0)},error:t=>{m.error(t.message).subscribe()}})}})},voidOrder(){try{const s=new Promise((t,r)=>{Popup.show(J,{resolve:t,reject:r,title:c("Confirm Your Action"),message:c("The current order will be void. This action will be recorded. Consider providing a reason for this operation"),onAction:_=>{_!==!1&&v.post(`/api/nexopos/v4/orders/${this.order.id}/void`,{reason:_}).subscribe({next:d=>{m.success(d.message).subscribe(),this.refreshCrudTable(),this.closePopup(!0)},error:d=>{m.error(d.message).subscribe()}})}})})}catch(s){console.log(s)}},refreshCrudTable(){this.$popupParams.component.$emit("updated",!0)}},watch:{active(){this.active==="details"&&this.loadOrderDetails(this.order.id)}},mounted(){this.order=this.$popupParams.order,this.options=systemOptions,this.settings=systemSettings,this.loadOrderDetails(this.order.id),this.popupCloser()}};window.nsOrderPreviewPopup=G;const xr=G,wr={class:"h-95vh w-95vw md:h-6/7-screen md:w-6/7-screen overflow-hidden shadow-xl ns-box flex flex-col"},gr={class:"border-b ns-box-header p-3 flex items-center justify-between"},kr={class:"p-2 overflow-scroll ns-box-body flex flex-auto"},Pr={key:1,class:"h-full w-full flex items-center justify-center"},Cr={class:"p-2 flex justify-between border-t ns-box-footer"},$r=e("i",{class:"las la-ban"},null,-1),Sr=e("i",{class:"las la-trash"},null,-1),jr=e("i",{class:"las la-print"},null,-1);function Vr(s,t,r,_,d,n){const b=h("ns-close-button"),o=h("ns-order-details"),u=h("ns-tabs-item"),g=h("ns-order-payment"),f=h("ns-order-refund"),C=h("ns-order-instalments"),L=h("ns-tabs"),W=h("ns-spinner"),I=h("ns-button");return l(),a("div",wr,[e("div",gr,[e("div",null,[e("h3",null,i(s.__("Order Options")),1)]),e("div",null,[y(b,{onClick:t[0]||(t[0]=$=>s.closePopup(!0))})])]),e("div",kr,[s.order.id?(l(),P(L,{key:0,active:s.active,onActive:t[5]||(t[5]=$=>s.setActive($))},{default:k(()=>[y(u,{label:s.__("Details"),identifier:"details",class:"overflow-y-auto"},{default:k(()=>[y(o,{order:s.order},null,8,["order"])]),_:1},8,["label"]),["order_void","hold","refunded","partially_refunded"].includes(s.order.payment_status)?p("",!0):(l(),P(u,{key:0,label:s.__("Payments"),identifier:"payments",class:"overflow-y-auto"},{default:k(()=>[y(g,{onChanged:t[1]||(t[1]=$=>s.refresh()),order:s.order},null,8,["order"])]),_:1},8,["label"])),["order_void","hold","refunded"].includes(s.order.payment_status)?p("",!0):(l(),P(u,{key:1,label:s.__("Refund & Return"),identifier:"refund",class:"flex overflow-y-auto"},{default:k(()=>[y(f,{onLoadTab:t[2]||(t[2]=$=>s.setActive($)),onChanged:t[3]||(t[3]=$=>s.refresh()),order:s.order},null,8,["order"])]),_:1},8,["label"])),["partially_paid","unpaid"].includes(s.order.payment_status)&&s.order.support_instalments?(l(),P(u,{key:2,label:s.__("Installments"),identifier:"instalments",class:"flex overflow-y-auto"},{default:k(()=>[y(C,{onChanged:t[4]||(t[4]=$=>s.refresh()),order:s.order},null,8,["order"])]),_:1},8,["label"])):p("",!0)]),_:1},8,["active"])):p("",!0),s.order.id?p("",!0):(l(),a("div",Pr,[y(W)]))]),e("div",Cr,[e("div",null,[s.isVoidable?(l(),P(I,{key:0,onClick:t[6]||(t[6]=$=>s.voidOrder()),type:"error"},{default:k(()=>[$r,V(" "+i(s.__("Void")),1)]),_:1})):p("",!0),s.isDeleteAble?(l(),P(I,{key:1,onClick:t[7]||(t[7]=$=>s.deleteOrder()),type:"error"},{default:k(()=>[Sr,V(" "+i(s.__("Delete")),1)]),_:1})):p("",!0)]),e("div",null,[y(I,{onClick:t[8]||(t[8]=$=>s.printOrder()),type:"info"},{default:k(()=>[jr,V(" "+i(s.__("Print")),1)]),_:1})])])])}var qr=O(xr,[["render",Vr]]);export{qr as n};
