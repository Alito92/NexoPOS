import{f as y,a as p,b as _}from"./bootstrap-ece284e4.js";import{_ as b}from"./currency-ab26e44d.js";import{m as v}from"./npm~@vue~runtime-dom_-aa3a306b.js";import{_ as k}from"./_plugin-vue_export-helper-c27b6911.js";import{f as w}from"./npm~rxjs-eeb06f17.js";import{ak as P,ac as o,A as l,D as n,aG as j,z as d,F as u,ai as f,c as x}from"./npm~@vue~runtime-core_-ff0546fa.js";import{U as h,z as T}from"./npm~@vue~shared_-3ce114fe.js";import"./npm~lodash-9a4afe3d.js";import"./npm~@ckeditor~ckeditor5-build-classic_-27365139.js";import"./npm~laravel-echo-198fd56d.js";import"./npm~pusher-js-a179ff58.js";import"./npm~axios-28bc18a3.js";import"./npm~chart.js-3fed1729.js";import"./npm~moment-fbc5633a.js";import"./npm~vue-4c913503.js";import"./npm~@vue~compiler-dom_-85e36bcf.js";import"./npm~@vue~compiler-core_-be14e06b.js";import"./npm~@vue~reactivity_-547540a3.js";import"./npm~rx-da74c705.js";import"./npm~@wordpress~hooks_-bd0b7221.js";import"./npm~mathjs-d162420d.js";import"./npm~@babel~runtime_-57eb5ba4.js";import"./npm~decimal.js-d133ee8e.js";import"./npm~complex.js-2f8f27d8.js";import"./npm~fraction.js-704ae1f4.js";import"./npm~typed-function-de33f2d8.js";import"./npm~seedrandom-4e17e537.js";import"./npm~javascript-natural-sort-82d7d2c3.js";import"./npm~escape-latex-6c71499e.js";import"./npm~numeral-85b533a7.js";import"./npm~currency.js-57f74176.js";import"./npm~tslib-8dbab242.js";const C={name:"ns-permissions",filters:[y],data(){return{permissions:[],toggled:!1,roles:[],searchText:""}},computed:{filteredPermissions(){return this.searchText.length!==0?this.permissions.filter(e=>{const s=new RegExp(this.searchText,"i");return s.test(e.name)||s.test(e.namespace)}):this.permissions}},mounted(){this.loadPermissionsAndRoles(),nsHotPress.create("ns-permissions").whenPressed("shift+/",e=>{this.$refs.search.focus(),setTimeout(()=>{this.searchText=""},5)}).whenPressed("/",e=>{this.$refs.search.focus(),setTimeout(()=>{this.searchText=""},5)})},methods:{__:b,async selectAllPermissions(e){const s=new Object;s[e.namespace]=new Object;let i=!1;if(e.locked&&(i=await new Promise((a,t)=>{Popup.show(nsConfirmPopup,{title:b("Confirm Your Action"),message:b("Would you like to bulk edit a system role ?"),onAction:c=>a(!!c)})})),!e.locked||e.locked&&i){const a=this.filterObjectByKeys(e.fields,this.filteredPermissions.map(t=>t.namespace));for(let t in a)e.fields[t].value=e.field.value,s[e.namespace][t]=e.field.value;this.arrayToObject(this.filteredPermissions,"namespace",t=>s[e.namespace][t.namespace]),p.put("/api/users/roles",s).subscribe(t=>{_.success(t.message,null,{duration:3e3}).subscribe()})}else e.field.value=!e.field.value},filterObjectByKeys(e,s){return Object.fromEntries(Object.entries(e).filter(([i])=>s.includes(i)))},arrayToObject(e,s,i){return Object.assign({},...e.map(a=>({[a[s]]:i(a)})))},submitPermissions(e,s){const i=new Object;i[e.namespace]=new Object,i[e.namespace][s.name]=s.value,p.put("/api/users/roles",i).subscribe(a=>{_.success(a.message,null,{duration:3e3}).subscribe()})},loadPermissionsAndRoles(){return w([p.get("/api/users/roles"),p.get("/api/users/permissions")]).subscribe(e=>{this.permissions=e[1],this.roles=e[0].map(s=>(s.fields={},s.field={type:"checkbox",name:s.namespace,value:!1},this.permissions.forEach(i=>{s.fields[i.namespace]={type:"checkbox",value:s.permissions.filter(a=>a.namespace===i.namespace).length>0,name:i.namespace,label:null}}),s))})}}},O={id:"permission-wrapper"},A={class:"my-2"},B=["placeholder"],E={class:"rounded shadow ns-box flex"},R={id:"permissions",class:"w- bg-gray-800 flex-shrink-0"},V={class:"h-24 py-4 px-2 border-b border-gray-700 text-gray-100 flex justify-between items-center"},z={key:0},D=n("i",{class:"las la-expand"},null,-1),N=[D],F=n("i",{class:"las la-compress"},null,-1),H=[F],K=["title"],S={key:0},U={key:1},G={class:"flex flex-auto overflow-hidden"},J={class:"overflow-y-auto"},L={class:"text-gray-700 flex"},M={class:"mx-1"},W={class:"mx-1"};function Y(e,s,i,a,t,c){const g=P("ns-checkbox");return o(),l("div",O,[n("div",A,[j(n("input",{ref:"search","onUpdate:modelValue":s[0]||(s[0]=r=>t.searchText=r),type:"text",placeholder:c.__('Press "/" to search permissions'),class:"border-2 p-2 w-full outline-none bg-input-background border-input-edge text-primary"},null,8,B),[[v,t.searchText]])]),n("div",E,[n("div",R,[n("div",V,[t.toggled?d("",!0):(o(),l("span",z,h(c.__("Permissions")),1)),n("div",null,[t.toggled?d("",!0):(o(),l("button",{key:0,onClick:s[1]||(s[1]=r=>t.toggled=!t.toggled),class:"rounded-full bg-white text-gray-700 h-6 w-6 flex items-center justify-center"},N)),t.toggled?(o(),l("button",{key:1,onClick:s[2]||(s[2]=r=>t.toggled=!t.toggled),class:"rounded-full bg-white text-gray-700 h-6 w-6 flex items-center justify-center"},H)):d("",!0)])]),(o(!0),l(u,null,f(c.filteredPermissions,r=>(o(),l("div",{key:r.id,class:T([t.toggled?"w-24":"w-54","p-2 border-b border-gray-700 text-gray-100"])},[n("a",{href:"javascript:void(0)",title:r.namespace},[t.toggled?d("",!0):(o(),l("span",S,h(r.name),1)),t.toggled?(o(),l("span",U,h(r.name),1)):d("",!0)],8,K)],2))),128))]),n("div",G,[n("div",J,[n("div",L,[(o(!0),l(u,null,f(t.roles,r=>(o(),l("div",{key:r.id,class:"h-24 py-4 px-2 w-56 items-center border-b justify-center flex role flex-shrink-0 border-r border-table-th-edge"},[n("p",M,[n("span",null,h(r.name),1)]),n("span",W,[x(g,{onChange:m=>c.selectAllPermissions(r),field:r.field},null,8,["onChange","field"])])]))),128))]),(o(!0),l(u,null,f(c.filteredPermissions,r=>(o(),l("div",{key:r.id,class:"permission flex"},[(o(!0),l(u,null,f(t.roles,m=>(o(),l("div",{key:m.id,class:"border-b border-table-th-edge w-56 flex-shrink-0 p-2 flex items-center justify-center border-r"},[x(g,{onChange:q=>c.submitPermissions(m,m.fields[r.namespace]),field:m.fields[r.namespace]},null,8,["onChange","field"])]))),128))]))),128))])])])])}const Ce=k(C,[["render",Y]]);export{Ce as default};
