import{_ as l,j as L,p as P,k as x,o as a,a as d,b as o,t as u,l as w,q as g,s as k,e as h,F as _,g as y,n as B,i as A,f as v,m as b}from"./bootstrap.5d9ac093.js";import{_ as S}from"./ns-numpad-plus.ce205eaf.js";import"./ns-notice.610564cb.js";import T from"./ns-pos-confirm-popup.cef1fbda.js";import{n as F}from"./currency.ec6652ed.js";const N={name:"ns-expense-selector",data(){return{configurations:[],warningMessage:!1,type:null}},mounted(){this.configurations=this.$popupParams.configurations,this.warningMessage=this.$popupParams.warningMessage,this.type=this.$popupParams.type},methods:{__:l,nsCurrency:F,popupResolver:L,popupCloser:P,selectType(e){this.popupResolver(e)}}},V={class:"w-6/7-screen md:w-4/7-screen lg:w-3/7-screen flex flex-col shadow-lg ns-box"},j={class:"ns-box-header p-2 border-b flex justify-between items-center"},$={class:"font-bold text-xl"},R={key:0,class:"p-2"},U=["innerHTML"],W={class:"grid grid-cols-2"},H=["onClick"],O=["src","alt"],D={class:"font-bold"};function J(e,s,n,f,t,i){const p=x("ns-notice");return a(),d("div",V,[o("div",j,[o("h3",$,u(i.__("Expense Type")),1)]),t.warningMessage?(a(),d("div",R,[w(p,{color:"info"},{title:g(()=>[k(u(i.__("Warning")),1)]),default:g(()=>[o("span",{innerHTML:t.warningMessage},null,8,U)]),_:1})])):h("",!0),o("div",W,[(a(!0),d(_,null,y(t.configurations,r=>(a(),d("div",{class:B([t.type===r.identifier?"info":"","h-40 elevation-surface hoverable flex-col flex items-center justify-center cursor-pointer"]),onClick:C=>i.selectType(r),key:r.identifier},[o("img",{src:r.icon,class:"w-20 my-2",alt:r.label},null,8,O),o("h3",D,u(r.label),1)],10,H))),128))])])}var q=S(N,[["render",J]]);const z={props:[],data(){return{configurations:[],activeTab:"create-customers",selectedConfiguration:{},isLoading:!1,tabs:[],expense:{},originalRecurrence:[],validation:new A,recurrence:[],warningMessage:!1}},computed:{},mounted(){window.nsExpenseData!==void 0&&(this.expense=window.nsExpenseData),this.init()},watch:{},methods:{__:l,nsCurrency:F,confirmBeforeSave(){Popup.show(T,{title:l("Confirm Your Action"),message:l("The expense is about to be saved. Would you like to confirm your action ?"),onAction:e=>{e&&this.saveExpense()}})},saveExpense(){const e=this.expense.id!==void 0?"put":"post",s=this.expense.id!==void 0?`/api/nexopos/v4/crud/ns.expenses/${this.expense.id}`:"/api/nexopos/v4/crud/ns.expenses",n=this.configurations.filter(r=>r.identifier===this.selectedConfiguration.identifier);if(n.length!==1)return v.error(l("No configuration were choosen. Unable to proceed.")).subscribe();if(!this.validation.validateFields(n[0].fields))return v.error(l("Unable to proceed the form is not valid.")).subscribe();this.validation.disableFields(n[0].fields);const f=this.validation.extractFields(n[0].fields),t=this.validation.extractFields(this.recurrence),i={...f,...t},p={general:{}};for(let r in i)r==="name"?p[r]=i[r]:p.general[r]=i[r];nsHttpClient[e](s,p).subscribe({next:r=>{v.success(r.message).subscribe(),setTimeout(()=>{document.location=r.data.editUrl},1e3)},error:r=>{this.validation.enableFields(n[0].fields),v.error(r.message||l("An unexpected error occured.")).subscribe()}})},updateSelectLabel(){this.recurrence.length>0&&(this.recurrence[0].options=this.recurrence[0].options.map((e,s)=>{const n=this.originalRecurrence[0].options[s];return["x_after_month_starts","x_before_month_ends"].includes(e.value)?(e.label=n.label.replace("{day}",this.recurrence[1].value>=0&&this.recurrence[1].value<=1?`${this.recurrence[1].value} day`:`${this.recurrence[1].value} days`),e.label=n.label.replace("{day}",this.recurrence[1].value>=0&&this.recurrence[1].value<=1?`${this.recurrence[1].value} day`:`${this.recurrence[1].value} days`)):["on_specific_day"].includes(e.value)&&(e.label=n.label.replace("{day}",this.ordinalSuffix(this.recurrence[1].value))),e}))},setActiveTab(e){this.activeTab=e,this.updateSelectLabel()},executeCondition(e,s){if(e.shows){const n=s.filter(t=>Object.keys(e.shows).includes(t.name));return n.filter(t=>e.shows[t.name].includes(t.value)).length===n.length}return!0},setTabs(){const e=[{label:this.selectedConfiguration.label||l("N/A"),identifier:"general",active:!0,fields:this.selectedConfiguration.fields}];["ns.recurring-expenses","ns.salary-expenses"].includes(this.selectedConfiguration.identifier)&&e.push({label:l("Conditions"),identifier:"recurrence"}),this.tabs=e},async init(){try{this.isLoading=!0;const{configurations:e,recurrence:s,warningMessage:n}=await this.loadConfiguration();if(this.configurations=e,this.recurrence=s,this.warningMessage=n,this.originalRecurrence=JSON.parse(JSON.stringify(s)),this.expense.type===void 0)await this.selectExpenseType();else{const f=this.configurations.filter(t=>t.identifier===this.expense.type);if(f.length==0)return v.error(l("Unable to load the expense.")).subscribe();this.processSelectedConfiguration(f[0])}this.isLoading=!1,this.setTabs()}catch(e){console.log(e)}},processSelectedConfiguration(e){e.fields=this.validation.createFields(e.fields),e.fields.forEach(s=>{s.name==="recurring"&&(["ns.recurring-expenses","ns.salary-expenses"].includes(e.identifier)?s.value=!0:s.value=!1),s.name==="type"&&(s.value=e.identifier)}),this.selectedConfiguration=e},async selectExpenseType(){try{const e=await new Promise((s,n)=>{Popup.show(q,{resolve:s,reject:n,configurations:this.configurations,type:this.expense.type,warningMessage:this.warningMessage})});this.processSelectedConfiguration(e)}catch(e){console.log(e)}},confirmTypeChange(){Popup.show(T,{title:l("Change Type"),message:l("By proceeding the current for and all your entries will be cleared. Would you like to proceed?"),onAction:e=>{e&&(delete this.expense.type,this.init())}})},ordinalSuffix(e){var s=e%10,n=e%100;return s==1&&n!=11?e+"st":s==2&&n!=12?e+"nd":s==3&&n!=13?e+"rd":e+"th"},loadConfiguration(){return new Promise((e,s)=>{nsHttpClient.get(`/api/nexopos/v4/expenses/configurations/${this.expense.id?this.expense.id:""}`).subscribe({next:n=>{e(n)},error:n=>{s(n)}})})}}},Y={key:0,class:"h-half w-full flex items-center justify-center"},G={key:1},I={class:"md:flex hidden flex-col md:flex-row -mx-2"},K={class:"px-2"},Q={class:"ns-button info"},X={class:"px-2"},Z={class:"ns-button success"},ee={class:"my-3 md:hidden"},se={class:"flex -mx-2"},ne={class:"px-2"},te={class:"ns-button info"},ie={class:"px-2"},re={class:"ns-button success"};function oe(e,s,n,f,t,i){const p=x("ns-spinner"),r=x("ns-notice"),C=x("ns-field"),E=x("ns-tabs-item"),M=x("ns-tabs");return a(),d(_,null,[t.isLoading?(a(),d("div",Y,[w(p)])):h("",!0),t.tabs.length>0&&!t.isLoading?(a(),d("div",G,[w(M,{active:t.activeTab,onActive:s[5]||(s[5]=c=>i.setActiveTab(c))},{extra:g(()=>[o("div",I,[o("div",K,[o("div",Q,[o("button",{onClick:s[0]||(s[0]=c=>i.confirmTypeChange()),class:"py-1 px-2 text-sm rounded"},u(i.__("Change Type")),1)])]),o("div",X,[o("div",Z,[o("button",{onClick:s[1]||(s[1]=c=>i.confirmBeforeSave()),class:"py-1 px-2 text-sm rounded"},u(i.__("Save Expense")),1)])])])]),default:g(()=>[(a(!0),d(_,null,y(t.tabs,c=>(a(),b(E,{key:c.identifier,identifier:c.identifier,label:c.label},{default:g(()=>[c.fields?(a(),d(_,{key:0},[t.selectedConfiguration.identifier==="ns.salary-expenses"?(a(),b(r,{key:0,class:"mb-2",color:"info"},{title:g(()=>[k(u(i.__("Warning")),1)]),description:g(()=>[k(u(i.__("While selecting salary expense, the amount defined will be multiplied by the total user assigned to the User group selected.")),1)]),_:1})):h("",!0),(a(!0),d(_,null,y(c.fields,m=>(a(),b(C,{key:m.name,field:m},null,8,["field"]))),128))],64)):h("",!0),c.identifier==="recurrence"?(a(!0),d(_,{key:1},y(t.recurrence,m=>(a(),d(_,{key:m.name},[i.executeCondition(m,t.recurrence)?(a(),b(C,{key:0,onChange:s[2]||(s[2]=ae=>i.updateSelectLabel()),field:m},null,8,["field"])):h("",!0)],64))),128)):h("",!0)]),_:2},1032,["identifier","label"]))),128)),o("div",ee,[o("div",se,[o("div",ne,[o("div",te,[o("button",{onClick:s[3]||(s[3]=c=>i.confirmTypeChange()),class:"py-1 px-2 text-sm rounded"},u(i.__("Change Type")),1)])]),o("div",ie,[o("div",re,[o("button",{onClick:s[4]||(s[4]=c=>i.confirmBeforeSave()),class:"py-1 px-2 text-sm rounded"},u(i.__("Save Expense")),1)])])])])]),_:1},8,["active"])])):h("",!0)],64)}var pe=S(z,[["render",oe]]);export{pe as default};
