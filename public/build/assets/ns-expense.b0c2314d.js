import{_ as a,j as L,p as P,o,a as l,b as i,t as u,F as p,g,n as A,i as N,f as v,l as w,e as _,q as x,k as m,m as b,s as k}from"./bootstrap.5d9ac093.js";import{_ as S}from"./ns-numpad-plus.ce205eaf.js";import"./ns-notice.610564cb.js";import T from"./ns-pos-confirm-popup.cef1fbda.js";import{n as E}from"./currency.ec6652ed.js";const V={name:"ns-expense-selector",data(){return{configurations:[],type:null}},mounted(){this.configurations=this.$popupParams.configurations,this.type=this.$popupParams.type},methods:{__:a,nsCurrency:E,popupResolver:L,popupCloser:P,selectType(e){this.popupResolver(e)}}},j={class:"w-6/7-screen md:w-4/7-screen lg:w-3/7-screen flex flex-col shadow-lg ns-box"},$={class:"ns-box-header p-2 border-b flex justify-between items-center"},R={class:"font-bold text-xl"},D={class:"grid grid-cols-2"},O=["onClick"],W=["src","alt"],U={class:"font-bold"};function H(e,s,t,f,r,n){return o(),l("div",j,[i("div",$,[i("h3",R,u(n.__("Expense Type")),1)]),i("div",D,[(o(!0),l(p,null,g(r.configurations,d=>(o(),l("div",{class:A([r.type===d.identifier?"info":"","h-40 elevation-surface hoverable flex-col flex items-center justify-center cursor-pointer"]),onClick:y=>n.selectType(d),key:d.identifier},[i("img",{src:d.icon,class:"w-20 my-2",alt:d.label},null,8,W),i("h3",U,u(d.label),1)],10,O))),128))])])}var J=S(V,[["render",H]]);const q={props:[],data(){return{configurations:[],activeTab:"create-customers",selectedConfiguration:{},isLoading:!1,tabs:[],expense:{},originalRecurrence:[],validation:new N,recurrence:[]}},computed:{},mounted(){console.log(window.nsExpenseData),window.nsExpenseData!==void 0&&(this.expense=window.nsExpenseData),this.init()},watch:{},methods:{__:a,nsCurrency:E,confirmBeforeSave(){Popup.show(T,{title:a("Confirm Your Action"),message:a("The expense is about to be saved. Would you like to confirm your action ?"),onAction:e=>{e&&this.saveExpense()}})},saveExpense(){const e=this.expense.id!==void 0?"put":"post",s=this.expense.id!==void 0?`/api/nexopos/v4/expenses/${this.expense.id}`:"/api/nexopos/v4/expenses",t=this.configurations.filter(n=>n.identifier===this.selectedConfiguration.identifier);if(t.length!==1)return v.error(a("No configuration were choosen. Unable to proceed.")).subscribe();if(!this.validation.validateFields(t[0].fields))return v.error(a("Unable to proceed the form is not valid.")).subscribe();const f=this.validation.extractFields(t[0].fields),r=this.validation.extractFields(this.recurrence);nsHttpClient[e](s,{...f,...r}).subscribe({next:n=>{v.success(n.message).subscribe()},error:n=>{v.error(n.message||a("An unexpected error occured.")).subscribe()}})},updateSelectLabel(){this.recurrence.length>0&&(this.recurrence[0].options=this.recurrence[0].options.map((e,s)=>{const t=this.originalRecurrence[0].options[s];return["x_days_after_month_starts","x_days_before_month_ends"].includes(e.value)?(e.label=t.label.replace("{day}",this.recurrence[1].value>=0&&this.recurrence[1].value<=1?`${this.recurrence[1].value} day`:`${this.recurrence[1].value} days`),e.label=t.label.replace("{day}",this.recurrence[1].value>=0&&this.recurrence[1].value<=1?`${this.recurrence[1].value} day`:`${this.recurrence[1].value} days`)):["on_specific_day"].includes(e.value)&&(e.label=t.label.replace("{day}",this.ordinalSuffix(this.recurrence[1].value))),e}))},setActiveTab(e){this.activeTab=e,this.updateSelectLabel()},executeCondition(e,s){if(e.shows){const t=s.filter(r=>Object.keys(e.shows).includes(r.name));return t.filter(r=>e.shows[r.name].includes(r.value)).length===t.length}return!0},setTabs(){const e=[{label:this.selectedConfiguration.label||a("N/A"),identifier:"general",active:!0,fields:this.selectedConfiguration.fields}];["ns.recurring-expenses","ns.salary-expenses"].includes(this.selectedConfiguration.identifier)&&e.push({label:a("Conditions"),identifier:"recurrence"}),this.tabs=e},async init(){try{this.isLoading=!0;const{configurations:e,recurrence:s}=await this.loadConfiguration();if(this.configurations=e,this.recurrence=s,this.originalRecurrence=JSON.parse(JSON.stringify(s)),this.expense.type===void 0)await this.selectExpenseType();else{const t=this.configurations.filter(f=>f.identifier===this.expense.type);this.processSelectedConfiguration(t[0])}this.isLoading=!1,this.setTabs()}catch(e){console.log(e)}},processSelectedConfiguration(e){e.fields=this.validation.createFields(e.fields),e.fields.forEach(s=>{s.name==="reccuring"&&(["ns.recurring-expenses","ns.salary-expenses"].includes(e.identifier)?s.value=!0:s.value=!1),s.name==="type"&&(s.value=e.identifier)}),this.selectedConfiguration=e},async selectExpenseType(){try{const e=await new Promise((s,t)=>{Popup.show(J,{resolve:s,reject:t,configurations:this.configurations,type:this.expense.type})});this.processSelectedConfiguration(e)}catch(e){console.log(e)}},confirmTypeChange(){Popup.show(T,{title:a("Change Type"),message:a("By proceeding the current for and all your entries will be cleared. Would you like to proceed?"),onAction:e=>{e&&(delete this.expense.type,this.init())}})},ordinalSuffix(e){var s=e%10,t=e%100;return s==1&&t!=11?e+"st":s==2&&t!=12?e+"nd":s==3&&t!=13?e+"rd":e+"th"},loadConfiguration(){return new Promise((e,s)=>{nsHttpClient.get(`/api/nexopos/v4/expenses/configurations/${this.expense.id?this.expense.id:""}`).subscribe({next:t=>{e(t)},error:t=>{s(t)}})})}}},z={key:0,class:"h-half w-full flex items-center justify-center"},Y={key:1},G={class:"md:flex hidden flex-col md:flex-row -mx-2"},I={class:"px-2"},K={class:"ns-button info"},M={class:"px-2"},Q={class:"ns-button success"},X={class:"my-3 md:hidden"},Z={class:"flex -mx-2"},ee={class:"px-2"},se={class:"ns-button info"},te={class:"px-2"},ne={class:"ns-button success"};function ie(e,s,t,f,r,n){const d=m("ns-spinner"),y=m("ns-notice"),C=m("ns-field"),F=m("ns-tabs-item"),B=m("ns-tabs");return o(),l(p,null,[r.isLoading?(o(),l("div",z,[w(d)])):_("",!0),r.tabs.length>0&&!r.isLoading?(o(),l("div",Y,[w(B,{active:r.activeTab,onActive:s[5]||(s[5]=c=>n.setActiveTab(c))},{extra:x(()=>[i("div",G,[i("div",I,[i("div",K,[i("button",{onClick:s[0]||(s[0]=c=>n.confirmTypeChange()),class:"py-1 px-2 text-sm rounded"},u(n.__("Change Type")),1)])]),i("div",M,[i("div",Q,[i("button",{onClick:s[1]||(s[1]=c=>n.confirmBeforeSave()),class:"py-1 px-2 text-sm rounded"},u(n.__("Save Expense")),1)])])])]),default:x(()=>[(o(!0),l(p,null,g(r.tabs,c=>(o(),b(F,{key:c.identifier,identifier:c.identifier,label:c.label},{default:x(()=>[c.fields?(o(),l(p,{key:0},[r.selectedConfiguration.identifier==="ns.salary-expenses"?(o(),b(y,{key:0,class:"mb-2",color:"info"},{title:x(()=>[k(u(n.__("Warning")),1)]),description:x(()=>[k(u(n.__("While selecting salary expense, the amount defined will be multiplied by the total user assigned to the User group selected.")),1)]),_:1})):_("",!0),(o(!0),l(p,null,g(c.fields,h=>(o(),b(C,{key:h.name,field:h},null,8,["field"]))),128))],64)):_("",!0),c.identifier==="recurrence"?(o(!0),l(p,{key:1},g(r.recurrence,h=>(o(),l(p,{key:h.name},[n.executeCondition(h,r.recurrence)?(o(),b(C,{key:0,onChange:s[2]||(s[2]=re=>n.updateSelectLabel()),field:h},null,8,["field"])):_("",!0)],64))),128)):_("",!0)]),_:2},1032,["identifier","label"]))),128)),i("div",X,[i("div",Z,[i("div",ee,[i("div",se,[i("button",{onClick:s[3]||(s[3]=c=>n.confirmTypeChange()),class:"py-1 px-2 text-sm rounded"},u(n.__("Change Type")),1)])]),i("div",te,[i("div",ne,[i("button",{onClick:s[4]||(s[4]=c=>n.confirmBeforeSave()),class:"py-1 px-2 text-sm rounded"},u(n.__("Save Expense")),1)])])])])]),_:1},8,["active"])])):_("",!0)],64)}var ue=S(q,[["render",ie]]);export{ue as default};
